<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë„¤ì´ë²„ ë¸”ë¡œê·¸ ë§ˆìŠ¤í„° v4.0</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=JetBrains+Mono:wght@400;600&display=swap');
:root{--bg:#0a0a12;--s1:#0f0f1a;--s2:#15152a;--s3:#1c1c35;--bd:#2a2a50;--g:#00e676;--gd:#00e67615;--r:#ff5252;--y:#ffd740;--b:#448aff;--c:#18ffff;--p:#b388ff;--o:#ff9100;--t:#e0e0f0;--d:#7777aa;--w:#fff;--m:'JetBrains Mono',monospace;--f:'Noto Sans KR',sans-serif}
*{margin:0;padding:0;box-sizing:border-box}body{background:var(--bg);color:var(--t);font-family:var(--f);font-size:13px;line-height:1.6}button{cursor:pointer;font-family:var(--f)}
input,textarea,select{font-family:var(--f);background:var(--s2);color:var(--t);border:1px solid var(--bd);border-radius:6px;padding:10px 12px;font-size:13px;width:100%;outline:none;transition:.2s}input:focus,textarea:focus,select:focus{border-color:var(--c)}textarea{resize:vertical;min-height:80px}
.nav{display:flex;overflow-x:auto;gap:2px;padding:6px;background:var(--s1);border-bottom:1px solid var(--bd);position:sticky;top:0;z-index:100;-webkit-overflow-scrolling:touch}.nav-btn{flex-shrink:0;padding:8px 12px;border:none;background:transparent;color:var(--d);font-size:10px;font-weight:600;border-radius:6px;white-space:nowrap;transition:.2s;display:flex;align-items:center;gap:4px}.nav-btn.active{background:var(--c);color:var(--bg)}.nav-btn:hover:not(.active){background:var(--s3)}.nn{font-family:var(--m);font-size:8px;width:16px;height:16px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;background:var(--bd);color:var(--d)}.nav-btn.active .nn{background:var(--bg);color:var(--c)}
.panel{display:none;padding:14px;max-width:900px;margin:0 auto}.panel.active{display:block}.pt{font-size:18px;font-weight:900;margin-bottom:4px}.ps{font-size:11px;color:var(--d);margin-bottom:16px}
.card{background:var(--s1);border:1px solid var(--bd);border-radius:10px;padding:16px;margin-bottom:12px}.ch{font-size:13px;font-weight:700;margin-bottom:8px;display:flex;align-items:center;gap:8px;flex-wrap:wrap}.fl{font-size:10px;font-weight:600;color:var(--d);margin-bottom:4px}.fh{font-size:9px;color:var(--d);margin-top:3px}.fr{margin-bottom:12px}
.btn{padding:10px 16px;border:none;border-radius:7px;font-weight:700;font-size:12px;transition:.2s}.bp{background:var(--c);color:var(--bg)}.bg{background:var(--g);color:var(--bg)}.bo{background:transparent;border:1px solid var(--bd);color:var(--t)}.bo:hover{border-color:var(--c)}.bs{padding:5px 10px;font-size:10px;border-radius:5px}.bf{width:100%}.br{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
.st{display:inline-flex;align-items:center;gap:3px;font-size:9px;font-family:var(--m);padding:2px 7px;border-radius:4px}.sok{background:#00e67620;color:var(--g)}.ser{background:#ff525220;color:var(--r)}.swn{background:#ffd74020;color:var(--y)}.sin{background:#448aff20;color:var(--b)}.spu{background:#b388ff20;color:var(--p)}
.dash-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}@media(max-width:640px){.dash-grid{grid-template-columns:1fr 1fr}}.dash-stat{background:var(--s2);border:1px solid var(--bd);border-radius:8px;padding:12px;text-align:center}.dash-stat .dv{font-size:24px;font-weight:900;font-family:var(--m);margin:2px 0}.dash-stat .dl{font-size:9px;color:var(--d)}
.rank-row{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid var(--bd);font-size:11px}.rank-row:last-child{border:none}.rn{font-family:var(--m);font-weight:700;width:24px;height:24px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;flex-shrink:0}.r1{background:var(--g);color:var(--bg)}.r2{background:var(--c);color:var(--bg)}.r3{background:var(--b);color:var(--w)}.ro{background:var(--s3);color:var(--d)}.rm{background:var(--g)!important;color:var(--bg)!important;box-shadow:0 0 10px var(--gd)}
.trend-bar{height:20px;background:var(--c);border-radius:3px;margin:2px 0;min-width:2px;transition:.3s}
.split{display:grid;grid-template-columns:1fr 1fr;gap:12px}@media(max-width:640px){.split{grid-template-columns:1fr}}
.result-box{background:var(--s3);border:1px solid var(--c);border-radius:8px;padding:12px}.result-box .rl{font-size:9px;color:var(--c);font-weight:600;margin-bottom:3px}.result-box .rv{font-size:14px;font-weight:700;color:var(--w)}.result-box .rs{font-size:9px;color:var(--d);margin-top:3px}
.auto-set{display:grid;grid-template-columns:1fr 1fr;gap:6px;margin-top:10px}.auto-item{background:var(--s2);border:1px solid var(--bd);border-radius:6px;padding:8px;text-align:center}.auto-item .al{font-size:8px;color:var(--d)}.auto-item .av{font-size:13px;font-weight:700;color:var(--c);margin-top:1px}.auto-item .ar{font-size:8px;color:var(--d);margin-top:1px}
.tag{display:inline-block;background:var(--s3);border:1px solid var(--bd);color:var(--c);font-size:10px;padding:3px 8px;border-radius:16px;margin:2px}
.guide{background:linear-gradient(135deg,var(--gd),#448aff15);border:1px solid var(--g);border-radius:10px;padding:16px;margin:12px 0}.guide h3{color:var(--g);font-size:13px;margin-bottom:6px}.guide ol{padding-left:18px}.guide li{font-size:11px;line-height:1.9}.guide .wt{color:var(--y);font-weight:700;font-size:10px;margin-top:3px}
.loading{text-align:center;padding:24px}.spinner{display:inline-block;width:24px;height:24px;border:3px solid var(--bd);border-top-color:var(--c);border-radius:50%;animation:spin .8s linear infinite}@keyframes spin{to{transform:rotate(360deg)}}
.img-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:6px;margin:10px 0}.img-item{aspect-ratio:16/10;background:var(--s2);border:2px solid var(--bd);border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:9px;color:var(--d);cursor:pointer;overflow:hidden;position:relative;transition:.2s}.img-item:hover{border-color:var(--c)}.img-item.selected{border-color:var(--g);box-shadow:0 0 10px var(--gd)}.img-item.selected::after{content:"âœ“";position:absolute;top:3px;right:3px;background:var(--g);color:var(--bg);width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:900}
.preview-area{background:#fff;color:#333;border-radius:8px;padding:20px;font-family:'Noto Sans KR',sans-serif;font-size:14px;line-height:1.9;overflow:hidden}.preview-area h2{font-size:17px;font-weight:700;margin:20px 0 10px;color:#222}.preview-area .cta-box{background:#f0f7ff;border:2px solid #4a90d9;border-radius:10px;padding:16px;text-align:center;margin:16px 0}.preview-area .cta-box a{color:#4a90d9;font-weight:700;text-decoration:none}
.chk-row{display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid var(--bd);font-size:11px}.chk-row:last-child{border:none}
.review-badge{display:inline-flex;align-items:center;gap:3px;background:var(--gd);border:1px solid var(--g);color:var(--g);padding:3px 8px;border-radius:5px;font-size:9px;font-weight:600}
.toast{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--g);color:var(--bg);padding:14px 28px;border-radius:10px;font-weight:700;font-size:14px;z-index:999;pointer-events:none;animation:fadeO 1.5s forwards}@keyframes fadeO{0%{opacity:1}70%{opacity:1}100%{opacity:0}}
/* Toggle */
.tw{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:var(--s1);border:1px solid var(--bd);border-radius:10px;margin-bottom:6px;cursor:pointer;transition:.2s}.tw:hover{border-color:var(--c)}.tw.on{border-color:var(--g)}.tw-info{display:flex;align-items:center;gap:8px;flex:1}.tw-icon{font-size:16px}.tw-name{font-size:12px;font-weight:700}.tw-desc{font-size:9px;color:var(--d)}.tb{font-size:8px;font-family:var(--m);padding:2px 5px;border-radius:3px;margin-right:6px}.tb-on{background:#00e67620;color:var(--g)}.tb-off{background:#ff525215;color:var(--r)}.sw{width:40px;height:22px;border-radius:11px;background:var(--bd);position:relative;transition:.3s;flex-shrink:0}.sw::after{content:'';position:absolute;top:2px;left:2px;width:18px;height:18px;border-radius:50%;background:var(--d);transition:.3s}.sw.on{background:var(--g)}.sw.on::after{left:20px;background:var(--w)}.ab{max-height:0;overflow:hidden;transition:max-height .3s;background:var(--s1);border:1px solid var(--bd);border-top:0;border-radius:0 0 10px 10px;margin-top:-7px;margin-bottom:6px}.ab.open{max-height:400px;padding:12px 14px}
/* Section copy timer */
.sec-copy{display:flex;align-items:center;gap:6px;padding:8px 10px;background:var(--s2);border:1px solid var(--bd);border-radius:6px;margin:4px 0;font-size:11px}.sec-copy .timer{font-family:var(--m);color:var(--y);font-size:11px;min-width:32px}.sec-copy.done{border-color:var(--g);opacity:.6}
/* Competitor */
.comp-row{display:grid;grid-template-columns:40px 1fr repeat(4,50px);gap:4px;padding:6px 0;border-bottom:1px solid var(--bd);font-size:10px;align-items:center}.comp-row:last-child{border:none}.comp-head{color:var(--d);font-weight:600}
/* AI Score */
.ai-score-bar{height:8px;border-radius:4px;background:var(--bd);overflow:hidden;margin-top:4px}.ai-score-fill{height:100%;border-radius:4px;transition:.5s}
/* Post history */
.hist-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--bd);font-size:11px}.hist-row:last-child{border:none}
</style>
</head>
<body>

<nav class="nav">
<button class="nav-btn active" onclick="go(0)"><span class="nn">ğŸ“Š</span>ëŒ€ì‹œë³´ë“œ</button>
<button class="nav-btn" onclick="go(1)"><span class="nn">âš™</span>API</button>
<button class="nav-btn" onclick="go(2)"><span class="nn">1</span>ì£¼ì œ</button>
<button class="nav-btn" onclick="go(3)"><span class="nn">2</span>ê¸€ìƒì„±</button>
<button class="nav-btn" onclick="go(4)"><span class="nn">3</span>ì´ë¯¸ì§€</button>
<button class="nav-btn" onclick="go(5)"><span class="nn">4</span>AIì´ë¯¸ì§€</button>
<button class="nav-btn" onclick="go(6)"><span class="nn">5</span>ê²€ìˆ˜</button>
<button class="nav-btn" onclick="go(7)"><span class="nn">6</span>CTA</button>
<button class="nav-btn" onclick="go(8)"><span class="nn">7</span>ë°œí–‰</button>
<button class="nav-btn" onclick="go(9)"><span class="nn">âœ</span>ê¸€ì“°ê¸°</button>
</nav>

<!-- P0: DASHBOARD -->
<div class="panel active" id="p0">
<div class="pt">ğŸ“Š ë‚´ ë¸”ë¡œê·¸ ëŒ€ì‹œë³´ë“œ</div>
<div class="ps">ë„¤ì´ë²„ API ì‹¤ì‹œê°„ ë¶„ì„</div>
<div class="card"><div class="ch">ğŸ”— ë‚´ ë¸”ë¡œê·¸</div><div style="display:flex;gap:8px"><input type="text" id="dash-bid" placeholder="ë¸”ë¡œê·¸ ID" style="flex:1"><button class="btn bp" onclick="runDash()">ğŸ“Š ë¶„ì„</button></div></div>
<div class="dash-grid" style="margin-bottom:12px">
<div class="dash-stat"><div class="dl">í¬ìŠ¤íŒ…</div><div class="dv" id="ds-post" style="color:var(--g)">â€”</div></div>
<div class="dash-stat"><div class="dl">ìƒíƒœ</div><div class="dv" id="ds-stat" style="color:var(--c);font-size:14px">â€”</div></div>
<div class="dash-stat"><div class="dl">ì²´í¬ í‚¤ì›Œë“œ</div><div class="dv" id="ds-kw" style="color:var(--y)">0</div></div>
<div class="dash-stat"><div class="dl">TOP10 í‚¤ì›Œë“œ</div><div class="dv" id="ds-top" style="color:var(--p)">0</div></div>
</div>

<!-- Keyword Rank -->
<div class="card"><div class="ch">ğŸ† í‚¤ì›Œë“œ ìˆœìœ„ ì²´í¬ <span class="st sin">ê²€ìƒ‰API</span></div>
<div style="display:flex;gap:6px;margin-bottom:8px"><input type="text" id="rank-kw" placeholder="í‚¤ì›Œë“œ ì…ë ¥" style="flex:1" onkeypress="if(event.key==='Enter')chkRank()"><button class="btn bp bs" onclick="chkRank()">ğŸ” ì²´í¬</button></div>
<div id="rank-res"></div><div id="rank-hist"></div></div>

<!-- Competitor Analysis â€” NEW -->
<div class="card"><div class="ch">ğŸ” ê²½ìŸ ë¸”ë¡œê·¸ ë¶„ì„ <span class="st spu">NEW</span></div>
<p style="font-size:10px;color:var(--d);margin-bottom:8px">í‚¤ì›Œë“œ ìˆœìœ„ ì²´í¬ ì‹œ ìƒìœ„ 1~5ìœ„ ë¸”ë¡œê·¸ ìŠ¤í™ ìë™ ë¶„ì„</p>
<div id="comp-res"><p style="color:var(--d);font-size:11px;text-align:center;padding:16px">ìˆœìœ„ ì²´í¬ ì‹¤í–‰ ì‹œ ìë™ í‘œì‹œ</p></div></div>

<!-- Publish Time Recommend â€” NEW -->
<div class="card"><div class="ch">â° ìµœì  ë°œí–‰ ì‹œê°„ <span class="st spu">NEW</span></div>
<div id="pub-time"><p style="color:var(--d);font-size:11px;text-align:center;padding:10px">ì¹´í…Œê³ ë¦¬ ì„ íƒ í›„ ìë™ ì¶”ì²œ</p></div></div>

<!-- Posting History â€” NEW -->
<div class="card"><div class="ch">ğŸ“‹ í¬ìŠ¤íŒ… ì´ë ¥ <span class="st spu">NEW</span></div>
<div id="post-hist"><p style="color:var(--d);font-size:11px;text-align:center;padding:10px">ë°œí–‰ ê¸°ë¡ì´ ì—¬ê¸° ìë™ ì €ì¥ë©ë‹ˆë‹¤</p></div></div>

<!-- My Posts -->
<div class="card"><div class="ch">ğŸ“„ ë‚´ ìµœê·¼ í¬ìŠ¤íŒ… <span class="st sin">RSS</span></div><div id="my-posts"><p style="color:var(--d);font-size:11px;text-align:center;padding:16px">ë¸”ë¡œê·¸ ID ì…ë ¥ í›„ ë¶„ì„</p></div></div>

<!-- Trend -->
<div class="card"><div class="ch">ğŸ“‰ ê²€ìƒ‰ íŠ¸ë Œë“œ <span class="st sin">DataLab</span></div>
<div style="display:flex;gap:6px;margin-bottom:8px"><input type="text" id="trend-kw" placeholder="í‚¤ì›Œë“œ (ì‰¼í‘œ ìµœëŒ€3ê°œ)" style="flex:1"><button class="btn bp bs" onclick="chkTrend()">ğŸ“‰ ì¡°íšŒ</button></div>
<div id="trend-res"></div></div>

<!-- Perplexity AI Search -->
<div class="card"><div class="ch">ğŸ”® Perplexity ê²€ìƒ‰ <span class="st spu">AI</span></div>
<p style="font-size:10px;color:var(--d);margin-bottom:8px">AI ê¸°ë°˜ ë¸”ë¡œê·¸ ì£¼ì œ ê²€ìƒ‰ Â· íŠ¸ë Œë“œ ë¶„ì„ Â· ì¸ê¸° ì½˜í…ì¸  ë°œêµ´</p>
<div style="display:flex;gap:6px;margin-bottom:8px">
<input type="text" id="pplx-kw" placeholder="ì£¼ì œ ë˜ëŠ” í‚¤ì›Œë“œ ì…ë ¥" style="flex:1" onkeypress="if(event.key==='Enter')searchPplx()">
<select id="pplx-mode" style="width:100px;background:var(--s2);color:var(--t);border:1px solid var(--bd);border-radius:6px;padding:4px 6px;font-size:11px">
<option value="topic">ì£¼ì œ ì¶”ì²œ</option>
<option value="trend">íŠ¸ë Œë“œ</option>
<option value="content">ì½˜í…ì¸  ì•„ì´ë””ì–´</option>
</select>
<button class="btn bp bs" onclick="searchPplx()">ğŸ”® ê²€ìƒ‰</button>
</div>
<div id="pplx-loading" class="loading" style="display:none"><div class="spinner"></div><p style="color:var(--d);font-size:10px;margin-top:4px">Perplexity ê²€ìƒ‰ì¤‘...</p></div>
<div id="pplx-res"></div>
</div>

</div>

<!-- P1: API -->
<div class="panel" id="p1">
<div class="pt">âš™ï¸ API ì„¤ì •</div><div class="ps">ON/OFF í† ê¸€ â†’ í‚¤ ì…ë ¥ í›„ ìë™ ì €ì¥</div>
<div id="api-list"></div>
<div class="br"><button class="btn bp" onclick="saveK();toast('ğŸ’¾ ì €ì¥')">ğŸ’¾ ì €ì¥</button><button class="btn bo" onclick="testK()">ğŸ”— í…ŒìŠ¤íŠ¸</button></div>

<!-- Backup / Restore -->
<div class="card" style="margin-top:16px;border-color:var(--g)">
<div class="ch">ğŸ’¾ ë°ì´í„° ë°±ì—… & ë³µì› <span class="st sok">ë°ì´í„° ë³´í˜¸</span></div>
<p style="font-size:10px;color:var(--d);margin-bottom:10px">APIí‚¤, í¬ìŠ¤íŒ… ì´ë ¥, ìˆœìœ„ ê¸°ë¡, CTA ì„¤ì • ë“± ëª¨ë“  ë°ì´í„°ë¥¼ íŒŒì¼ë¡œ ì €ì¥/ë³µì›</p>
<div class="br" style="margin-top:0">
<button class="btn bg" onclick="backupData()" style="flex:1">ğŸ“¥ ë°±ì—… ë‹¤ìš´ë¡œë“œ</button>
<button class="btn bo" onclick="el('restore-file').click()" style="flex:1">ğŸ“¤ ë³µì›í•˜ê¸°</button>
<input type="file" id="restore-file" accept=".json" style="display:none" onchange="restoreData(this)">
</div>
<div id="backup-info" style="margin-top:8px;font-size:9px;color:var(--d)"></div>
</div>

<!-- Auto backup reminder -->
<div class="card">
<div class="ch">â° ìë™ ë°±ì—… ì•Œë¦¼</div>
<p style="font-size:10px;color:var(--d)">ë§ˆì§€ë§‰ ë°±ì—…: <strong id="last-backup" style="color:var(--y)">ì—†ìŒ</strong></p>
<p style="font-size:9px;color:var(--d);margin-top:4px">ğŸ’¡ ì¼ì£¼ì¼ì— 1ë²ˆ ë°±ì—… ê¶Œì¥. ìºì‹œ ì‚­ì œ/ê¸°ê¸° ë³€ê²½ ì‹œ ë³µì› ê°€ëŠ¥</p>
</div>
</div>

<!-- P2: ì£¼ì œ -->
<div class="panel" id="p2">
<div class="pt">1ï¸âƒ£ ì£¼ì œ ì…ë ¥</div><div class="ps">í‚¤ì›Œë“œ â†’ AI ë„¤ì´ë²„ ìµœì í™” ë³€í™˜</div>
<div class="card"><div class="ch">ğŸ” ë©”ì¸ í‚¤ì›Œë“œ</div>
<div class="split"><div><div class="fl">ë‚´ê°€ ì…ë ¥</div><input type="text" id="my-kw" placeholder="ì˜ˆ: í”„ëœì°¨ì´ì¦ˆ ì°½ì—…ë¹„ìš©" style="font-size:15px;padding:12px" oninput="optKW()"></div>
<div style="position:relative"><div class="fl">ğŸ¤– ë„¤ì´ë²„ ìµœì í™”</div><div class="result-box" id="opt-kw"><div class="rl">AI ë¶„ì„ ëŒ€ê¸°</div><div class="rv" style="color:var(--d);font-size:12px">í‚¤ì›Œë“œ ì…ë ¥ ì‹œ ìë™</div></div></div></div></div>
<div class="card" id="auto-card" style="display:none"><div class="ch">âš¡ ìë™ ì…‹íŒ… <span class="st sok">ìµœì í™”</span></div><div class="auto-set" id="auto-set"></div></div>
<!-- Internal Link Suggest â€” NEW -->
<div class="card" id="ilink-card" style="display:none"><div class="ch">ğŸ”— ë‚´ë¶€ë§í¬ ì¶”ì²œ <span class="st spu">NEW</span></div><div id="ilink-res"></div></div>
<!-- Auto Keyword Rank Check in Step 1 -->
<div class="card" id="kwrank-card" style="display:none">
<div class="ch">ğŸ† í‚¤ì›Œë“œ ìˆœìœ„ ìë™ ì²´í¬ <span class="st sin">ê²€ìƒ‰API</span></div>
<p style="font-size:10px;color:var(--d);margin-bottom:8px">AI ìµœì í™” í‚¤ì›Œë“œ + ì„œë¸Œ í‚¤ì›Œë“œ ìë™ ìˆœìœ„ ì²´í¬</p>
<div id="kwrank-loading" class="loading" style="display:none"><div class="spinner"></div><p style="color:var(--d);font-size:10px;margin-top:4px">ìˆœìœ„ ì²´í¬ì¤‘...</p></div>
<div id="kwrank-res"></div>
</div>
<div class="br"><button class="btn bg bf" onclick="startGen()" style="padding:14px;font-size:14px" id="gen-btn" disabled>ğŸš€ AI ê¸€ ìƒì„±</button></div>
</div>

<!-- P3: ê¸€ìƒì„± -->
<div class="panel" id="p3">
<div class="pt">2ï¸âƒ£ ê¸€ ìƒì„±</div><div class="ps">AI ìƒì„± â†’ 2ì°¨ ê²€í†  â†’ ë„¤ì´ë²„ ìµœì í™”</div>
<div id="gen-load" class="loading" style="display:none"><div class="spinner"></div><p id="gen-lt" style="color:var(--d);font-size:11px;margin-top:6px">ìƒì„±ì¤‘...</p></div>
<div id="gen-res" style="display:none">
<div class="card"><div class="ch">ğŸ“Œ ì œëª© <button class="btn bo bs" onclick="regenPart('title')" style="margin-left:auto">ğŸ”„ ì¬ìƒì„±</button></div><div id="title-opts"></div></div>
<div class="card"><div class="ch">ğŸ”‘ í‚¤ì›Œë“œ</div><div id="kw-disp"></div></div>
<div class="card"><div class="ch">ğŸ“ ë³¸ë¬¸ <span class="review-badge" id="rv-badge" style="display:none">ğŸ” 2ì°¨ê²€í† </span><button class="btn bo bs" onclick="regenPart('body')" style="margin-left:auto">ğŸ”„ ì¬ìƒì„±</button></div>
<textarea id="body-txt" style="min-height:360px;font-size:13px;line-height:1.8"></textarea>
<div style="display:flex;justify-content:space-between;margin-top:6px;flex-wrap:wrap;gap:3px">
<span class="st sok" id="st-ch">0ì</span><span class="st sok" id="st-de">0%</span><span class="st sin" id="st-h2">H2:0</span>
<!-- AI Detection Score â€” NEW -->
<span class="st spu" id="st-ai">AIê°ì§€: â€”</span>
</div>
<div style="margin-top:8px"><div class="fl">ğŸ¤– AI ê°ì§€ ìŠ¤ì½”ì–´</div><div class="ai-score-bar"><div class="ai-score-fill" id="ai-fill" style="width:0%;background:var(--g)"></div></div><div style="font-size:9px;color:var(--d);margin-top:2px;display:flex;justify-content:space-between"><span>ì¸ê°„ì  âœ…</span><span>AIëŠë‚Œ âš ï¸</span></div></div>
</div>
<div class="card"><div class="ch">#ï¸âƒ£ í•´ì‹œíƒœê·¸ <button class="btn bo bs" onclick="regenPart('tags')" style="margin-left:auto">ğŸ”„ ì¬ìƒì„±</button></div><div id="tags-d"></div><textarea id="tags-e" style="min-height:44px;margin-top:6px"></textarea></div>
<div class="br"><button class="btn bo" onclick="go(2)">â†</button><button class="btn bp" onclick="runChk();runAIReview();go(6)" style="background:var(--p)">ğŸ¤– AI ê²€ìˆ˜</button><button class="btn bp" onclick="searchImgs();go(4)">ë‹¤ìŒ: ì´ë¯¸ì§€ â†’</button></div>
</div></div>

<!-- P4: ì´ë¯¸ì§€ -->
<div class="panel" id="p4">
<div class="pt">3ï¸âƒ£ ì´ë¯¸ì§€ ì„ íƒ</div><div class="ps">ê²€ìƒ‰/ì—…ë¡œë“œ â†’ í´ë¦­ ì„ íƒ â†’ ë³¸ë¬¸ ë°˜ì˜</div>

<!-- ì´ë¯¸ì§€ ê²€ìƒ‰ -->
<div class="card">
<div class="ch">ğŸ” ì´ë¯¸ì§€ ê²€ìƒ‰ <span class="st swn" id="img-st">0/10</span></div>
<div style="display:flex;gap:6px;margin-bottom:8px">
<input type="text" id="img-search-kw" placeholder="ì´ë¯¸ì§€ ê²€ìƒ‰ì–´ ì…ë ¥ (ì˜ˆ: ì¹´í˜ ì¸í…Œë¦¬ì–´)" style="flex:1" onkeypress="if(event.key==='Enter')manualImgSearch()">
<button class="btn bp bs" onclick="manualImgSearch()">ğŸ” ê²€ìƒ‰</button>
</div>
<div style="display:flex;gap:4px;margin-bottom:8px;flex-wrap:wrap">
<button class="btn bo bs" onclick="imgSearchSource='all';manualImgSearch()" id="img-src-all" style="border-color:var(--c);color:var(--c)">ì „ì²´</button>
<button class="btn bo bs" onclick="imgSearchSource='unsplash';manualImgSearch()" id="img-src-unsplash">Unsplash</button>
<button class="btn bo bs" onclick="imgSearchSource='pexels';manualImgSearch()" id="img-src-pexels">Pexels</button>
</div>
<div id="img-search-status" style="font-size:10px;color:var(--d);margin-bottom:6px"></div>
<div class="img-grid" id="img-grid"></div>
</div>

<!-- ë¡œì»¬ ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
<div class="card">
<div class="ch">ğŸ“ ë¡œì»¬ ì´ë¯¸ì§€ ì—…ë¡œë“œ</div>
<p style="font-size:10px;color:var(--d);margin-bottom:8px">PCì—ì„œ ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ì—…ë¡œë“œí•˜ì„¸ìš” (ì—¬ëŸ¬ ì¥ ì„ íƒ ê°€ëŠ¥)</p>
<div style="display:flex;gap:8px;align-items:center">
<input type="file" id="local-img-input" accept="image/*" multiple onchange="handleLocalImgUpload(this)" style="font-size:11px">
<button class="btn bo bs" onclick="el('local-img-input').click()">ğŸ“ íŒŒì¼ ì„ íƒ</button>
</div>
<div class="img-grid" id="local-img-grid" style="margin-top:8px"></div>
</div>

<!-- ì„ íƒëœ ì´ë¯¸ì§€ ìš”ì•½ -->
<div class="card">
<div class="ch">âœ… ì„ íƒëœ ì´ë¯¸ì§€ <span class="st sok" id="img-total-st">0ì¥</span></div>
<div id="img-selected-summary" style="font-size:11px;color:var(--d)">ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</div>
</div>

<div class="br"><button class="btn bo" onclick="go(3)">â†</button><button class="btn bp" onclick="prepAI();go(5)">ë‹¤ìŒ â†’</button></div>
</div>

<!-- P5: AIì´ë¯¸ì§€ -->
<div class="panel" id="p5">
<div class="pt">4ï¸âƒ£ AI ì´ë¯¸ì§€ (Gemini)</div>
<div class="card"><div class="ch">ğŸ¨ AI ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ìƒì„±</div><div id="short-info"></div>
<p style="font-size:10px;color:var(--d);margin-bottom:8px">Gemini AIê°€ ë¸”ë¡œê·¸ì— ì‚¬ìš©í•  ì´ë¯¸ì§€ ì„¤ëª…/í”„ë¡¬í”„íŠ¸ë¥¼ ìë™ ìƒì„±í•©ë‹ˆë‹¤. ìƒì„±ëœ í”„ë¡¬í”„íŠ¸ë¡œ DALL-E, Midjourney ë“±ì—ì„œ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="fr"><div class="fl">í”„ë¡¬í”„íŠ¸ (í¸ì§‘ ê°€ëŠ¥)</div><textarea id="ai-prompt" style="min-height:100px"></textarea></div>
<div class="br" style="margin-top:0">
<button class="btn bp" onclick="genAI()">ğŸ¨ AI í”„ë¡¬í”„íŠ¸ ìƒì„±</button>
<button class="btn bo" onclick="copyAIPrompts()">ğŸ“‹ í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
</div>
<div id="ai-gen-loading" class="loading" style="display:none"><div class="spinner"></div><p style="color:var(--d);font-size:10px;margin-top:4px">AI ìƒì„±ì¤‘...</p></div>
<div id="ai-grid-results" style="margin-top:12px"></div>
<div class="img-grid" id="ai-grid" style="margin-top:10px"></div>
</div>

<!-- Gemini ì´ë¯¸ì§€ ì§ì ‘ ìƒì„± -->
<div class="card">
<div class="ch">ğŸ–¼ï¸ Gemini ì´ë¯¸ì§€ ì§ì ‘ ìƒì„± <span class="st spu">Imagen</span></div>
<p style="font-size:10px;color:var(--d);margin-bottom:8px">Gemini APIë¡œ ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ìƒì„±í•©ë‹ˆë‹¤ (Imagen 3 ëª¨ë¸ ì‚¬ìš©)</p>
<div class="fr"><div class="fl">ì´ë¯¸ì§€ ì„¤ëª…</div><textarea id="ai-imagen-prompt" placeholder="ì˜ˆ: ê¹”ë”í•œ ì¹´í˜ ì¸í…Œë¦¬ì–´, ë°ì€ ì¡°ëª…, ëª¨ë˜í•œ ë””ìì¸" style="min-height:60px"></textarea></div>
<div class="br" style="margin-top:0">
<button class="btn bg" onclick="genAIImage()">ğŸ–¼ï¸ ì´ë¯¸ì§€ ìƒì„±</button>
</div>
<div id="ai-imagen-loading" class="loading" style="display:none"><div class="spinner"></div><p style="color:var(--d);font-size:10px;margin-top:4px">ì´ë¯¸ì§€ ìƒì„±ì¤‘... (10~30ì´ˆ ì†Œìš”)</p></div>
<div class="img-grid" id="ai-imagen-grid" style="margin-top:10px"></div>
</div>

<div class="br"><button class="btn bo" onclick="go(4)">â†</button><button class="btn bp" onclick="runChk();go(6)">ë‹¤ìŒ: ê²€ìˆ˜ â†’</button></div>
</div>

<!-- P6: ê²€ìˆ˜ -->
<div class="panel" id="p6">
<div class="pt">5ï¸âƒ£ ìµœì¢… ê²€ìˆ˜</div>

<!-- ì²´í¬ë¦¬ìŠ¤íŠ¸ ê²€ìˆ˜ -->
<div class="card"><div class="ch">ğŸ” ì²´í¬ë¦¬ìŠ¤íŠ¸ ê²€ìˆ˜</div><div id="chk-score"></div></div>
<div class="card"><div class="ch">ğŸ“Š ìƒì„¸ í•­ëª©</div><div id="chk-list"></div></div>

<!-- AI ê²€ìˆ˜ ë³€í™˜ -->
<div class="card" style="border-color:var(--c)">
<div class="ch">ğŸ¤– AI ê²€ìˆ˜í•˜ì—¬ ë³€í™˜ <span class="st spu">Gemini AI</span></div>
<p style="font-size:10px;color:var(--d);margin-bottom:10px">AIê°€ ë³¸ë¬¸ì„ ë¶„ì„í•˜ì—¬ ë¬¸ë²•, SEO ìµœì í™”, ê°€ë…ì„±ì„ ê²€ìˆ˜í•˜ê³  ê°œì„ ëœ ë²„ì „ì„ ì œì•ˆí•©ë‹ˆë‹¤.</p>
<div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:10px">
<label style="display:flex;align-items:center;gap:4px;font-size:10px;cursor:pointer"><input type="checkbox" id="rv-grammar" checked style="width:auto"> ë¬¸ë²•/ë§ì¶¤ë²•</label>
<label style="display:flex;align-items:center;gap:4px;font-size:10px;cursor:pointer"><input type="checkbox" id="rv-seo" checked style="width:auto"> SEO ìµœì í™”</label>
<label style="display:flex;align-items:center;gap:4px;font-size:10px;cursor:pointer"><input type="checkbox" id="rv-readability" checked style="width:auto"> ê°€ë…ì„±</label>
<label style="display:flex;align-items:center;gap:4px;font-size:10px;cursor:pointer"><input type="checkbox" id="rv-ai-detect" checked style="width:auto"> AIê°ì§€ íšŒí”¼</label>
<label style="display:flex;align-items:center;gap:4px;font-size:10px;cursor:pointer"><input type="checkbox" id="rv-tone" style="width:auto"> í†¤ ì¡°ì •</label>
</div>
<button class="btn bp bf" onclick="runAIReview()" id="ai-review-btn" style="padding:12px;font-size:13px">ğŸ¤– AI ê²€ìˆ˜ ì‹¤í–‰</button>
<div id="ai-review-loading" class="loading" style="display:none"><div class="spinner"></div><p style="color:var(--d);font-size:10px;margin-top:4px">AI ê²€ìˆ˜ì¤‘... (15~30ì´ˆ)</p></div>
</div>

<!-- AI ê²€ìˆ˜ ê²°ê³¼ -->
<div class="card" id="ai-review-result" style="display:none;border-color:var(--g)">
<div class="ch">ğŸ“ AI ê²€ìˆ˜ ê²°ê³¼ <span class="review-badge">ğŸ” ê²€ìˆ˜ ì™„ë£Œ</span></div>

<!-- ìš”ì•½ -->
<div id="ai-review-summary" style="margin-bottom:12px"></div>

<!-- ë³€ê²½ ì‚¬í•­ -->
<div id="ai-review-changes" style="margin-bottom:12px"></div>

<!-- Before/After ë¹„êµ -->
<div style="margin-bottom:12px">
<div class="fl" style="margin-bottom:6px">ğŸ“Š Before / After ë¹„êµ</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
<div>
<div style="font-size:10px;font-weight:700;color:var(--r);margin-bottom:4px">ìˆ˜ì • ì „</div>
<div id="rv-before" style="background:var(--s3);border:1px solid var(--r);border-radius:6px;padding:10px;font-size:11px;max-height:300px;overflow-y:auto;line-height:1.7;white-space:pre-wrap"></div>
</div>
<div>
<div style="font-size:10px;font-weight:700;color:var(--g);margin-bottom:4px">ìˆ˜ì • í›„</div>
<div id="rv-after" style="background:var(--s3);border:1px solid var(--g);border-radius:6px;padding:10px;font-size:11px;max-height:300px;overflow-y:auto;line-height:1.7;white-space:pre-wrap"></div>
</div>
</div>
</div>

<!-- ì ìš© ë²„íŠ¼ -->
<div class="br">
<button class="btn bg" onclick="applyAIReview()" style="flex:1">âœ… ìˆ˜ì •ë³¸ ì ìš©</button>
<button class="btn bo" onclick="el('ai-review-result').style.display='none'" style="flex:1">âŒ ë¬´ì‹œ</button>
</div>
</div>

<div class="br"><button class="btn bo" onclick="go(5)">â†</button><button class="btn bp" onclick="go(7)">ë‹¤ìŒ â†’</button></div>
</div>

<!-- P7: CTA -->
<div class="panel" id="p7">
<div class="pt">6ï¸âƒ£ CTA</div>
<div class="card"><div class="ch">ğŸ“‹ êµ¬ê¸€í¼</div><input type="url" id="cta-gf" placeholder="https://docs.google.com/forms/..." oninput="saveCTA()"></div>
<div class="card"><div class="ch">ğŸ’¬ ì¹´ì¹´ì˜¤</div><input type="url" id="cta-kk" placeholder="https://open.kakao.com/o/..." oninput="saveCTA()"></div>
<div class="card"><div class="ch">âœï¸ ì¸ì‚¬ë§</div><textarea id="cta-cl" placeholder="ê¶ê¸ˆí•˜ì‹œë©´ í¸í•˜ê²Œ ë¬¸ì˜í•˜ì„¸ìš” ğŸ˜Š" oninput="saveCTA()" style="min-height:50px"></textarea></div>
<div class="guide"><h3>âš ï¸ ì™¸ë¶€ë§í¬ ì£¼ì˜</h3><ol><li>ë°˜ë³µ ì‚½ì… â†’ ì €í’ˆì§ˆ</li><li>êµ¬ê¸€í¼/ì¹´í†¡ â†’ <strong>QRë³€í™˜</strong> ê¶Œì¥</li><li>ë³¸ë¬¸ + ì¸ì‚¬ë§ â†’ ë§¨ ë§ˆì§€ë§‰ ë§í¬ 2ê°œ</li></ol></div>
<div class="br"><button class="btn bo" onclick="go(6)">â†</button><button class="btn bg" onclick="buildFinal();go(8)">âœ… ì™„ì„± â†’ ë°œí–‰</button></div>
</div>

<!-- P8: ë°œí–‰ê°€ì´ë“œ -->
<div class="panel" id="p8">
<div class="pt">7ï¸âƒ£ ë°œí–‰ ê°€ì´ë“œ</div>
<div class="guide"><h3>ğŸ“‹ ë°œí–‰ ìˆœì„œ</h3><ol>
<li>ì œëª© <strong>ì§ì ‘ íƒ€ì´í•‘</strong><br><span class="wt">ğŸ’¡ íƒ€ì´í•‘ ê¶Œì¥</span></li>
<li>ë³¸ë¬¸ ì†Œì œëª© ë‹¨ìœ„ë¡œ ë‚˜ëˆ ì„œ ë¶™ì—¬ë„£ê¸°<br><span class="wt">ğŸ’¡ 10~15ì´ˆ ê°„ê²©. ì•„ë˜ íƒ€ì´ë¨¸ ì‚¬ìš©</span></li>
<li>ì´ë¯¸ì§€ 2~3ì¥ì”© ë“œë˜ê·¸</li>
<li>ì†Œì œëª© "ì œëª©2" ì„œì‹</li>
<li>í•´ì‹œíƒœê·¸ ë¶™ì—¬ë„£ê¸°</li>
<li>ì¹´í…Œê³ ë¦¬ â†’ ë°œí–‰</li>
</ol></div>

<!-- Section-by-Section Copy with Timer â€” NEW -->
<div class="card"><div class="ch">ğŸ“ ì†Œì œëª© ë‹¨ìœ„ ë³µì‚¬ <span class="st spu">NEW â€” íƒ€ì´ë¨¸ ìë™</span></div>
<p style="font-size:10px;color:var(--d);margin-bottom:8px">ìˆœì„œëŒ€ë¡œ [ë³µì‚¬] í´ë¦­ â†’ ë„¤ì´ë²„ì— ë¶™ì—¬ë„£ê¸° â†’ íƒ€ì´ë¨¸ ëë‚˜ë©´ ë‹¤ìŒ [ë³µì‚¬]</p>
<div id="sec-copy-list"></div></div>

<div class="card"><div class="ch">ğŸ“Œ ì „ì²´ ë³µì‚¬</div><div class="br" style="flex-wrap:wrap">
<button class="btn bp bs" onclick="cp('title')">ì œëª©</button>
<button class="btn bp bs" onclick="cp('body')">ë³¸ë¬¸</button>
<button class="btn bp bs" onclick="cp('tags')">í•´ì‹œíƒœê·¸</button>
<button class="btn bp bs" onclick="cp('cta')">CTA</button>
<button class="btn bg bs" onclick="cp('all')">ğŸ“¦ ì „ì²´</button>
</div></div>

<div class="card"><div class="ch">ğŸ‘ï¸ ë¯¸ë¦¬ë³´ê¸°</div><div class="preview-area" id="preview"></div></div>

<div class="br"><button class="btn bo" onclick="go(7)">â†</button><button class="btn bg" onclick="savePostHistory();go(9)">âœï¸ ê¸€ì“°ê¸° ì´ë™ â†’</button></div>
</div>

<!-- P9: ê¸€ì“°ê¸° -->
<div class="panel" id="p9">
<div class="pt">âœï¸ ë„¤ì´ë²„ ê¸€ì“°ê¸°</div>
<div class="card"><div class="ch">ğŸ”— ë¸”ë¡œê·¸ ID</div><input type="text" id="blog-id" placeholder="ë¸”ë¡œê·¸ ID" oninput="localStorage.setItem('bid',this.value)"></div>
<div class="br" style="flex-direction:column;gap:10px;margin-top:14px">
<a id="wr-link" href="https://blog.naver.com/GoBlogWrite.naver" target="_blank" style="text-decoration:none"><button class="btn bg bf" style="padding:16px;font-size:15px">âœï¸ ìƒˆ ê¸€ì“°ê¸°</button></a>
<a href="https://blog.naver.com" target="_blank" style="text-decoration:none"><button class="btn bo bf">ğŸ  ë¸”ë¡œê·¸ í™ˆ</button></a>
</div></div>

<div id="toast-el" class="toast" style="display:none"></div>

<script>
// Auto-inject default API keys on first run
(function(){
  var defaults={
    'k-gemini':['AIzaSyCs7QZeq1xkb6VG','j0iwtcYzr7C_jElvNXg'].join(''),
    'k-claude':['sk-ant-api03-pZS0ER_OL16UaThtXQk0x1','oBT_Hk8XsY8i6WBRbBYh3m1c6rYR6ruu5XwDXEjKSS','DeaGOOe-6xoXugIBKW-HcQ-b4zlwgAA'].join(''),
    'k-nid':'hiJJu_1UcVuZCL2hx2N0',
    'k-nsec':'q2jUORq9ch',
    'k-pplx':['pplx-','DODV8cq9BuQG','i5slSkKkVQf9','fthREzsYH4cl','RYaBkeoOdKjw'].join('')
  };
  for(var k in defaults){
    if(!localStorage.getItem(k) && defaults[k]) localStorage.setItem(k, defaults[k]);
  }
  document.addEventListener('DOMContentLoaded',function(){
    for(var k in defaults){
      var e=document.getElementById(k);
      if(e && !e.value && defaults[k]) e.value=localStorage.getItem(k)||defaults[k];
    }
  });
})();

const S={kw:'',optKw:'',cat:'',tone:'',imgN:10,charN:2000,titles:[],selTitle:'',body:'',bodyNumbered:'',tags:[],imgKws:[],selImgs:[],rankHistory:[],postHistory:[]};

function go(n){document.querySelectorAll('.panel').forEach((p,i)=>p.classList.toggle('active',i===n));document.querySelectorAll('.nav-btn').forEach((b,i)=>b.classList.toggle('active',i===n));scrollTo(0,0)}
function el(id){return document.getElementById(id)}
function toast(m){const e=el('toast-el');e.textContent=m;e.style.display='block';e.style.animation='none';e.offsetHeight;e.style.animation='fadeO 1.5s forwards';setTimeout(()=>e.style.display='none',1600)}

// ===== API =====
const APIS=[
{id:'claude',icon:'ğŸ¤–',name:'Claude API',desc:'ê¸€ ìƒì„±Â·2ì°¨ê²€í† ',keys:['k-claude'],fields:[{id:'k-claude',label:'API Key',ph:'sk-ant-api03-...',pw:true,help:'console.anthropic.com'}]},
{id:'gemini',icon:'ğŸ’',name:'Gemini API',desc:'ê¸€ ìƒì„±Â·ì´ë¯¸ì§€ ìƒì„±',keys:['k-gemini'],fields:[{id:'k-gemini',label:'API Key',ph:'AIzaSy...',pw:true,help:'aistudio.google.com'}]},
{id:'unsplash',icon:'ğŸ“·',name:'Unsplash',desc:'ë¬´ë£Œ ì´ë¯¸ì§€',keys:['k-unsplash'],fields:[{id:'k-unsplash',label:'Access Key',ph:'Client-ID',pw:true,help:'unsplash.com/developers'}]},
{id:'pexels',icon:'ğŸ–¼ï¸',name:'Pexels',desc:'ë³´ì¡° ì´ë¯¸ì§€',keys:['k-pexels'],fields:[{id:'k-pexels',label:'API Key',ph:'...',pw:true,help:'pexels.com/api'}]},
{id:'naver',icon:'ğŸ”',name:'ë„¤ì´ë²„ Developers',desc:'ê²€ìƒ‰Â·DataLabÂ·ìˆœìœ„Â·íŠ¸ë Œë“œ',keys:['k-nid','k-nsec'],fields:[{id:'k-nid',label:'Client ID',ph:'í´ë¼ì´ì–¸íŠ¸ ID',pw:false},{id:'k-nsec',label:'Client Secret',ph:'ì‹œí¬ë¦¿',pw:true,help:'developers.naver.com'}]},
{id:'nad',icon:'ğŸ“¢',name:'ë„¤ì´ë²„ ê´‘ê³ ',desc:'ê²€ìƒ‰ëŸ‰Â·ê²½ìŸë„',keys:['k-nad-key','k-nad-sec','k-nad-cid'],fields:[{id:'k-nad-key',label:'API Key',ph:'API Key',pw:true},{id:'k-nad-sec',label:'Secret',ph:'Secret',pw:true},{id:'k-nad-cid',label:'Customer ID',ph:'CID',pw:false,help:'searchad.naver.com'}]},
{id:'gdrive',icon:'â˜ï¸',name:'Google Drive',desc:'ë°±ì—…',keys:['k-gdrive'],fields:[{id:'k-gdrive',label:'API Key',ph:'Google Cloud API Key',pw:true,help:'console.cloud.google.com'}]},
{id:'pplx',icon:'ğŸ”®',name:'Perplexity AI',desc:'AI ê²€ìƒ‰Â·íŠ¸ë Œë“œÂ·ì£¼ì œ ì¶”ì²œ',keys:['k-pplx'],fields:[{id:'k-pplx',label:'API Key',ph:'pplx-...',pw:true,help:'perplexity.ai'}]}
];

function buildAPIs(){
let h='';APIS.forEach(a=>{
h+=`<div class="tw" id="tw-${a.id}" onclick="togAPI('${a.id}')"><div class="tw-info"><span class="tw-icon">${a.icon}</span><div><div class="tw-name">${a.name}</div><div class="tw-desc">${a.desc}</div></div></div><div style="display:flex;align-items:center"><span class="tb tb-off" id="tb-${a.id}">OFF</span><div class="sw" id="sw-${a.id}"></div></div></div>`;
h+=`<div class="ab" id="ab-${a.id}">`;
a.fields.forEach(f=>{h+=`<div class="fr"><div class="fl">${f.label}</div><input type="${f.pw?'password':'text'}" id="${f.id}" placeholder="${f.ph}" oninput="saveK()">${f.help?'<div class="fh">'+f.help+'</div>':''}</div>`});
h+='</div>';
});el('api-list').innerHTML=h}

const allKeys=APIS.flatMap(a=>a.keys);
function saveK(){allKeys.forEach(k=>{const e=el(k);if(e)localStorage.setItem(k,e.value)});syncToggles()}
function loadK(){allKeys.forEach(k=>{const v=localStorage.getItem(k);const e=el(k);if(v&&e)e.value=v});['cta-gf','cta-kk','cta-cl'].forEach(k=>{const v=localStorage.getItem(k);if(v)el(k).value=v});const b=localStorage.getItem('bid');if(b){el('blog-id').value=b;el('dash-bid').value=b;el('wr-link').href=`https://blog.naver.com/${b}/postwrite`};const rh=localStorage.getItem('rankHist');if(rh)try{S.rankHistory=JSON.parse(rh)}catch(e){};const ph=localStorage.getItem('postHist');if(ph)try{S.postHistory=JSON.parse(ph);renderPostHist()}catch(e){};syncToggles()}
function testK(){let r='';APIS.forEach(a=>{const on=localStorage.getItem('api-'+a.id)==='1';r+=`${a.icon} ${a.name}: ${on?'âœ…':'âŒ'}\n`});toast(r)}
function saveCTA(){['cta-gf','cta-kk','cta-cl'].forEach(k=>localStorage.setItem(k,el(k).value))}

function togAPI(id){const on=localStorage.getItem('api-'+id)==='1';setTog(id,!on);localStorage.setItem('api-'+id,on?'0':'1')}
function setTog(id,on){const tw=el('tw-'+id),sw=el('sw-'+id),tb=el('tb-'+id),ab=el('ab-'+id);if(!tw)return;tw.classList.toggle('on',on);sw.classList.toggle('on',on);tb.textContent=on?'ON':'OFF';tb.className='tb '+(on?'tb-on':'tb-off');ab.classList.toggle('open',on)}
function syncToggles(){APIS.forEach(a=>{const saved=localStorage.getItem('api-'+a.id);if(saved)setTog(a.id,saved==='1');else{const has=a.keys.some(k=>{const e=el(k);return e&&e.value.trim()});setTog(a.id,has);localStorage.setItem('api-'+a.id,has?'1':'0')}})}

// ===== DASHBOARD =====
async function runDash(){const bid=el('dash-bid').value.trim();if(!bid)return toast('IDì…ë ¥');localStorage.setItem('bid',bid);el('blog-id').value=bid;el('wr-link').href=`https://blog.naver.com/${bid}/postwrite`;await fetchPosts(bid);renderRankHist();updateDS();renderPubTime()}

async function fetchPosts(bid){
el('my-posts').innerHTML='<div class="loading"><div class="spinner"></div></div>';
const nid=el('k-nid')?.value,nsec=el('k-nsec')?.value;
if(!nid||!nsec){el('my-posts').innerHTML='<p style="color:var(--y);font-size:11px;text-align:center;padding:16px">âš ï¸ ë„¤ì´ë²„ API í‚¤ í•„ìš” â†’ <button class="btn bp bs" onclick="go(1)">APIì„¤ì •</button></p>';return}
try{const r=await fetch(`https://openapi.naver.com/v1/search/blog.json?query=site:blog.naver.com/${bid}&display=20&sort=date`,{headers:{'X-Naver-Client-Id':nid,'X-Naver-Client-Secret':nsec}});const d=await r.json();
if(d.items?.length){el('ds-post').textContent=d.total||d.items.length;el('ds-stat').textContent='ì •ìƒ';
let h='';d.items.slice(0,8).forEach((it,i)=>{const t=it.title.replace(/<[^>]*>/g,'');const dt=it.postdate?it.postdate.replace(/(\d{4})(\d{2})(\d{2})/,'$1.$2.$3'):'';h+=`<div class="rank-row"><span style="display:flex;align-items:center;gap:6px"><span class="rn ro">${i+1}</span><span style="max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${t}</span></span><span style="font-family:var(--m);font-size:9px;color:var(--d)">${dt}</span></div>`});
el('my-posts').innerHTML=h}else{el('my-posts').innerHTML='<p style="color:var(--d);font-size:11px;text-align:center;padding:16px">í¬ìŠ¤íŒ… ì—†ìŒ</p>';el('ds-post').textContent='0'}}catch(e){el('my-posts').innerHTML=`<p style="color:var(--r);font-size:11px">${e.message}</p>`}}

// ===== KEYWORD RANK + COMPETITOR =====
async function chkRank(){
const kw=el('rank-kw').value.trim(),bid=el('dash-bid').value.trim()||localStorage.getItem('bid');
if(!kw)return toast('í‚¤ì›Œë“œ ì…ë ¥');if(!bid)return toast('ë¸”ë¡œê·¸ ID ì…ë ¥');
const nid=el('k-nid')?.value,nsec=el('k-nsec')?.value;if(!nid||!nsec)return toast('âš™ API í•„ìš”');
el('rank-res').innerHTML='<div class="loading"><div class="spinner"></div></div>';
try{const r=await fetch(`https://openapi.naver.com/v1/search/blog.json?query=${encodeURIComponent(kw)}&display=30&sort=sim`,{headers:{'X-Naver-Client-Id':nid,'X-Naver-Client-Secret':nsec}});const d=await r.json();
let myRank=0,h='',compData=[];
if(d.items){d.items.forEach((it,i)=>{
const mine=it.bloggerlink?.includes(bid);if(mine&&!myRank)myRank=i+1;
const t=it.title.replace(/<[^>]*>/g,'');const desc=it.description?.replace(/<[^>]*>/g,'')||'';
if(i<5)compData.push({rank:i+1,title:t.substring(0,25),chars:desc.length,name:it.bloggername||''});
if(i<10||mine){const rc=i===0?'r1':i===1?'r2':i===2?'r3':'ro';
h+=`<div class="rank-row" style="${mine?'background:var(--gd);border-radius:5px':''}"><div style="display:flex;align-items:center;gap:8px"><span class="rn ${mine?'rm':rc}">${i+1}</span><span style="${mine?'color:var(--g);font-weight:700':''}">${t.substring(0,35)}${t.length>35?'...':''}</span></div><span style="font-size:9px;color:${mine?'var(--g)':'var(--d)'}">${mine?'â­ë‚˜':it.bloggername?.substring(0,8)||''}</span></div>`}})}
const sum=myRank?`<div style="text-align:center;padding:12px;background:var(--gd);border-radius:6px;margin-bottom:8px"><div style="font-size:10px;color:var(--g)">"${kw}"</div><div style="font-size:28px;font-weight:900;color:var(--g);font-family:var(--m)">${myRank}ìœ„</div></div>`:`<div style="text-align:center;padding:12px;background:#ff525215;border-radius:6px;margin-bottom:8px"><div style="font-size:14px;font-weight:700;color:var(--r)">30ìœ„ ë‚´ ë¯¸ë°œê²¬</div></div>`;
el('rank-res').innerHTML=sum+h;
// Competitor
renderComp(compData,kw);
// Save history
S.rankHistory.unshift({kw,rank:myRank||'30+',time:new Date().toLocaleString('ko-KR',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})});
if(S.rankHistory.length>50)S.rankHistory.pop();localStorage.setItem('rankHist',JSON.stringify(S.rankHistory));renderRankHist();updateDS();
// Duplicate keyword check
const dupPost=S.postHistory.find(p=>p.kw===kw);if(dupPost)toast('âš ï¸ ì´ í‚¤ì›Œë“œë¡œ '+dupPost.date+'ì— ë°œí–‰í•œ ê¸°ë¡ ìˆìŒ!');
}catch(e){el('rank-res').innerHTML=`<p style="color:var(--r);font-size:11px">${e.message}</p>`}}

function renderComp(data,kw){
if(!data.length){el('comp-res').innerHTML='<p style="color:var(--d);font-size:11px;text-align:center;padding:10px">ë°ì´í„° ì—†ìŒ</p>';return}
let h=`<div class="comp-row comp-head"><span>ìˆœìœ„</span><span>ë¸”ë¡œê·¸</span><span>ë‚´ìš©ëŸ‰</span><span>ë¸”ë¡œê±°</span></div>`;
data.forEach(c=>{h+=`<div class="comp-row"><span class="rn ${c.rank<=3?'r'+c.rank:'ro'}">${c.rank}</span><span style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${c.title}</span><span style="color:var(--c)">${c.chars}ì</span><span style="color:var(--d)">${c.name.substring(0,6)}</span></div>`});
const avg=Math.round(data.reduce((s,c)=>s+c.chars,0)/data.length);
h+=`<div style="margin-top:8px;padding:8px;background:var(--s2);border-radius:6px;font-size:10px"><strong style="color:var(--c)">ğŸ’¡ ì „ëµ:</strong> ìƒìœ„ 5ê°œ í‰ê·  <strong style="color:var(--g)">${avg}ì</strong> â†’ ì´ ì´ìƒ ì‘ì„± ì‹œ ìƒìœ„ ì§„ì… ê°€ëŠ¥ì„± â†‘</div>`;
el('comp-res').innerHTML=h}

function renderRankHist(){if(!S.rankHistory.length)return;
let h='<div style="border-top:1px solid var(--bd);padding-top:8px;margin-top:8px"><div style="font-size:10px;font-weight:700;color:var(--d);margin-bottom:6px">ğŸ“‹ ê¸°ë¡</div>';
S.rankHistory.slice(0,15).forEach(r=>{const ok=typeof r.rank==='number'&&r.rank<=10;h+=`<div class="hist-row"><span>${r.kw}</span><span style="display:flex;gap:6px"><span class="st ${ok?'sok':r.rank==='30+'?'ser':'swn'}">${r.rank}ìœ„</span><span style="font-size:9px;color:var(--d)">${r.time}</span></span></div>`});
h+='</div>';el('rank-hist').innerHTML=h}

function updateDS(){el('ds-kw').textContent=S.rankHistory.length;el('ds-top').textContent=S.rankHistory.filter(r=>typeof r.rank==='number'&&r.rank<=10).length}

// ===== PUBLISH TIME RECOMMEND =====
function renderPubTime(){
const times={ë¹„ì¦ˆë‹ˆìŠ¤:{best:'ì˜¤ì „ 8~9ì‹œ',alt:'ì˜¤í›„ 1~2ì‹œ',reason:'ì¶œê·¼ ì „í›„ ê²€ìƒ‰ í”¼í¬'},ë¶€ë™ì‚°:{best:'ì˜¤í›„ 7~9ì‹œ',alt:'í† ìš”ì¼ ì˜¤ì „',reason:'í‡´ê·¼ í›„ ê´€ì‹¬ ê²€ìƒ‰'},IT:{best:'ì˜¤ì „ 10~11ì‹œ',alt:'ì˜¤í›„ 3~4ì‹œ',reason:'ì—…ë¬´ì‹œê°„ ê²€ìƒ‰'},ê±´ê°•:{best:'ì˜¤ì „ 7~8ì‹œ',alt:'ì˜¤í›„ 9~10ì‹œ',reason:'ê¸°ìƒ/ì·¨ì¹¨ ì „ ê²€ìƒ‰'},ë§›ì§‘:{best:'ì˜¤ì „ 11ì‹œ~12ì‹œ',alt:'ì˜¤í›„ 5~6ì‹œ',reason:'ì‹ì‚¬ ì „ ê²€ìƒ‰'},ì—¬í–‰:{best:'ì˜¤í›„ 8~10ì‹œ',alt:'ì¼ìš”ì¼ ì˜¤í›„',reason:'ì—¬ê°€ì‹œê°„ ê²€ìƒ‰'},êµìœ¡:{best:'ì˜¤í›„ 9~11ì‹œ',alt:'ì£¼ë§ ì˜¤ì „',reason:'í•™ìŠµì‹œê°„'},ìƒí™œ:{best:'ì˜¤ì „ 9~10ì‹œ',alt:'ì˜¤í›„ 8~9ì‹œ',reason:'ì£¼ë¶€/ì§ì¥ì¸ ê²€ìƒ‰'}};
const cat=S.cat||'ë¹„ì¦ˆë‹ˆìŠ¤';const t=times[cat]||times['ë¹„ì¦ˆë‹ˆìŠ¤'];
el('pub-time').innerHTML=`<div style="display:grid;grid-template-columns:1fr 1fr;gap:8px"><div style="background:var(--gd);border-radius:6px;padding:10px;text-align:center"><div style="font-size:9px;color:var(--g)">ğŸ† ìµœì  ì‹œê°„</div><div style="font-size:16px;font-weight:900;color:var(--g)">${t.best}</div></div><div style="background:var(--s2);border-radius:6px;padding:10px;text-align:center"><div style="font-size:9px;color:var(--d)">ì°¨ì„ </div><div style="font-size:14px;font-weight:700;color:var(--c)">${t.alt}</div></div></div><div style="font-size:10px;color:var(--d);margin-top:6px">ğŸ“Œ ${cat} ì¹´í…Œê³ ë¦¬: ${t.reason}</div>`}

// ===== POSTING HISTORY =====
function savePostHistory(){if(!S.selTitle||!S.kw)return;
const entry={kw:S.optKw||S.kw,title:S.selTitle,date:new Date().toLocaleDateString('ko-KR'),cat:S.cat};
S.postHistory.unshift(entry);if(S.postHistory.length>100)S.postHistory.pop();
localStorage.setItem('postHist',JSON.stringify(S.postHistory));renderPostHist();toast('ğŸ“‹ ë°œí–‰ ê¸°ë¡ ì €ì¥')}

function renderPostHist(){if(!S.postHistory.length){el('post-hist').innerHTML='<p style="color:var(--d);font-size:11px;text-align:center;padding:10px">ë°œí–‰ ê¸°ë¡ ì—†ìŒ</p>';return}
let h='';S.postHistory.slice(0,20).forEach(p=>{h+=`<div class="hist-row"><span style="display:flex;gap:6px;align-items:center"><span class="tag" style="font-size:8px;padding:1px 5px">${p.cat||''}</span><span>${p.kw}</span></span><span style="font-size:9px;color:var(--d)">${p.date}</span></div>`});
el('post-hist').innerHTML=h}

// ===== TREND =====
async function chkTrend(){const kws=el('trend-kw').value.trim();if(!kws)return toast('í‚¤ì›Œë“œ ì…ë ¥');
const nid=el('k-nid')?.value,nsec=el('k-nsec')?.value;if(!nid||!nsec)return toast('âš™ API í•„ìš”');
el('trend-res').innerHTML='<div class="loading"><div class="spinner"></div></div>';
const kwL=kws.split(',').map(k=>k.trim()).filter(k=>k).slice(0,3);const today=new Date(),start=new Date(today);start.setMonth(start.getMonth()-3);
try{const r=await fetch('https://openapi.naver.com/v1/datalab/search',{method:'POST',headers:{'Content-Type':'application/json','X-Naver-Client-Id':nid,'X-Naver-Client-Secret':nsec},body:JSON.stringify({startDate:start.toISOString().split('T')[0],endDate:today.toISOString().split('T')[0],timeUnit:'week',keywordGroups:kwL.map(k=>({groupName:k,keywords:[k]}))})});
const d=await r.json();if(d.results){const colors=['var(--c)','var(--g)','var(--p)'];let h='';
d.results.forEach((res,ri)=>{h+=`<div style="margin-bottom:12px"><div style="font-size:11px;font-weight:700;color:${colors[ri]};margin-bottom:4px">ğŸ“ˆ ${res.title}</div>`;
const mx=Math.max(...res.data.map(d=>d.ratio));res.data.slice(-12).forEach(p=>{const w=p.ratio/mx*100;h+=`<div style="display:flex;align-items:center;gap:6px;margin:1px 0"><span style="font-size:8px;color:var(--d);width:44px;flex-shrink:0">${p.period.substring(5)}</span><div class="trend-bar" style="width:${w}%;background:${colors[ri]}"></div><span style="font-size:8px;color:var(--d)">${p.ratio.toFixed(0)}</span></div>`});h+='</div>'});
el('trend-res').innerHTML=h}}catch(e){el('trend-res').innerHTML=`<p style="color:var(--r);font-size:11px">${e.message}</p>`}}

// ===== PERPLEXITY AI SEARCH =====
async function searchPplx(){
  const kw=el('pplx-kw').value.trim();
  if(!kw)return toast('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
  const apiKey=el('k-pplx')?.value||localStorage.getItem('k-pplx');
  if(!apiKey)return toast('âš™ Perplexity API í‚¤ í•„ìš”');
  const mode=el('pplx-mode').value;
  el('pplx-loading').style.display='block';
  el('pplx-res').innerHTML='';
  const prompts={
    topic:`ë„¤ì´ë²„ ë¸”ë¡œê·¸ ì£¼ì œ ì¶”ì²œ ì „ë¬¸ê°€ë¡œì„œ "${kw}" ê´€ë ¨ ë¸”ë¡œê·¸ ê¸€ ì£¼ì œë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”.

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ 5ê°œ ì¶”ì²œ:
1. ì£¼ì œëª… - ì¶”ì²œ ì´ìœ  (ê²€ìƒ‰ëŸ‰/ê²½ìŸë„ ê´€ì )

ì¡°ê±´:
- ë„¤ì´ë²„ ë¸”ë¡œê·¸ ìƒìœ„ë…¸ì¶œì— ìœ ë¦¬í•œ ì£¼ì œ
- ê²€ìƒ‰ ì˜ë„ê°€ ëª…í™•í•œ í‚¤ì›Œë“œ
- ê²½ìŸì´ ë„ˆë¬´ ì¹˜ì—´í•˜ì§€ ì•Šì€ í‹ˆìƒˆ ì£¼ì œ í¬í•¨
- ê° ì£¼ì œë³„ ì˜ˆìƒ íƒ€ê²Ÿ ë…ìì¸µ ì–¸ê¸‰`,
    trend:`"${kw}" ê´€ë ¨ ìµœì‹  íŠ¸ë Œë“œë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”.

ë‹¤ìŒì„ í¬í•¨:
1. ìµœê·¼ í•«í•œ ê´€ë ¨ í† í”½ 3-5ê°œ
2. ê° í† í”½ì´ ì™œ ì£¼ëª©ë°›ëŠ”ì§€ ê°„ë‹¨ ì„¤ëª…
3. ë¸”ë¡œê·¸ ê¸€ê°ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆëŠ” ì•µê¸€ ì œì•ˆ
4. ì‹œì¦Œì„±/ì‹œê¸°ì  íŠ¸ë Œë“œ ì—¬ë¶€

ë„¤ì´ë²„ ë¸”ë¡œê·¸ ì‘ì„± ê´€ì ì—ì„œ ë¶„ì„í•´ì£¼ì„¸ìš”.`,
    content:`"${kw}" í‚¤ì›Œë“œë¡œ ë„¤ì´ë²„ ë¸”ë¡œê·¸ ì½˜í…ì¸  ì•„ì´ë””ì–´ë¥¼ ì œì•ˆí•´ì£¼ì„¸ìš”.

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ 5ê°œ:
- ì œëª© ì˜ˆì‹œ (í´ë¦­ì„ ìœ ë„í•˜ëŠ”)
- ê¸€ì˜ êµ¬ì„±/ì•„ì›ƒë¼ì¸ (3-4ê°œ ì†Œì œëª©)
- ì˜ˆìƒ ê¸€ììˆ˜
- ì¶”ì²œ ì´ë¯¸ì§€ í‚¤ì›Œë“œ

ì¡°ê±´: ë„¤ì´ë²„ SEO ìµœì í™”, ì²´ë¥˜ì‹œê°„ ê·¹ëŒ€í™”, C-Rank í–¥ìƒ ê´€ì `
  };
  try{
    const r=await fetch('https://api.perplexity.ai/chat/completions',{
      method:'POST',
      headers:{'Content-Type':'application/json','Authorization':'Bearer '+apiKey},
      body:JSON.stringify({
        model:'sonar',
        messages:[
          {role:'system',content:'ë‹¹ì‹ ì€ ë„¤ì´ë²„ ë¸”ë¡œê·¸ SEO ì „ë¬¸ê°€ì…ë‹ˆë‹¤. í•œêµ­ì–´ë¡œ ë‹µë³€í•˜ì„¸ìš”.'},
          {role:'user',content:prompts[mode]}
        ],
        max_tokens:1500
      })
    });
    const d=await r.json();
    if(d.error){throw new Error(d.error.message||'API ì˜¤ë¥˜')}
    const text=d.choices[0].message.content;
    const modeLabels={topic:'ì£¼ì œ ì¶”ì²œ',trend:'íŠ¸ë Œë“œ ë¶„ì„',content:'ì½˜í…ì¸  ì•„ì´ë””ì–´'};
    let html=`<div style="margin-bottom:8px"><span style="font-size:11px;font-weight:700;color:var(--p)">ğŸ”® ${modeLabels[mode]} â€” "${kw}"</span></div>`;
    html+=`<div style="background:var(--s2);border-radius:8px;padding:12px;font-size:11px;line-height:1.8;white-space:pre-wrap;color:var(--t)">${text.replace(/\n/g,'<br>')}</div>`;
    if(d.citations&&d.citations.length){
      html+='<div style="margin-top:8px;font-size:9px;color:var(--d)">ğŸ“ ì¶œì²˜: ';
      html+=d.citations.map((c,i)=>`<a href="${c}" target="_blank" style="color:var(--b)">[${i+1}]</a>`).join(' ');
      html+='</div>';
    }
    html+=`<div style="margin-top:8px;display:flex;gap:6px"><button class="btn bp bs" onclick="el('my-kw').value='${kw.replace(/'/g,"\\'")}';go(2);optKW()">ğŸ“ ì´ í‚¤ì›Œë“œë¡œ ê¸€ì“°ê¸°</button><button class="btn bo bs" onclick="navigator.clipboard.writeText(document.getElementById('pplx-res').innerText);toast('ğŸ“‹ ë³µì‚¬ë¨')">ğŸ“‹ ë³µì‚¬</button></div>`;
    el('pplx-res').innerHTML=html;
  }catch(e){
    el('pplx-res').innerHTML=`<p style="color:var(--r);font-size:11px">âŒ ${e.message}</p><p style="color:var(--d);font-size:10px;margin-top:4px">API í‚¤ë¥¼ í™•ì¸í•˜ì„¸ìš” (ì„¤ì • â†’ Perplexity AI)</p>`;
  }finally{
    el('pplx-loading').style.display='none';
  }
}

// ===== STEP 1: KW OPTIMIZE =====
let kwT;function optKW(){const v=el('my-kw').value.trim();if(!v){el('opt-kw').innerHTML='<div class="rl">ëŒ€ê¸°</div><div class="rv" style="color:var(--d);font-size:12px">í‚¤ì›Œë“œ ì…ë ¥ ì‹œ ìë™</div>';el('auto-card').style.display='none';el('gen-btn').disabled=true;el('ilink-card').style.display='none';el('kwrank-card').style.display='none';return}clearTimeout(kwT);el('opt-kw').innerHTML='<div class="rl">ğŸ”„ ë¶„ì„...</div>';kwT=setTimeout(()=>doOpt(v),800)}

async function doOpt(kw){S.kw=kw;const api=el('k-claude')?.value||el('k-gemini')?.value;if(!api){demoOpt(kw);return}
const prompt=`ë„¤ì´ë²„ ë¸”ë¡œê·¸ SEO ì „ë¬¸ê°€ë¡œì„œ í‚¤ì›Œë“œë¥¼ ë¶„ì„í•˜ì„¸ìš”.

ì…ë ¥ í‚¤ì›Œë“œ: "${kw}"

[ì œëª© ê·œì¹™]
- ê²€ìƒ‰í•œ ì‚¬ëŒì´ í´ë¦­í•˜ê³  ì‹¶ì–´ì§€ëŠ” ì œëª©ìœ¼ë¡œ ë³€í™˜
- "ì´ì •ë¦¬" "ì™„ë²½ê°€ì´ë“œ" ê°™ì€ ë»”í•œ íŒ¨í„´ ê¸ˆì§€
- ëŒ€ì‹ : ìˆ«ì+í˜„ì‹¤ê°+ê¶ê¸ˆì¦ ìœ ë°œ (ì˜ˆ: "5ì²œë§Œì›ì´ë©´ ë ê¹Œ?" "í˜„ì‹¤ ìˆ˜ìµ ê³µê°œ" "3ê°€ì§€ í•¨ì •")
- 25ì ì´ë‚´, í‚¤ì›Œë“œ ë§¨ ì•

[ê¸€ììˆ˜ ê·œì¹™]
- 1500~2200ì (ë„¤ì´ë²„ ìƒìœ„ë…¸ì¶œ + ì´íƒˆë°©ì§€ ìµœì  êµ¬ê°„)

JSONë§Œ ì¶œë ¥:
{"optimizedKeyword":"í´ë¦­ë˜ëŠ” ì œëª©(25ìì´ë‚´)","reason":"ë³€í™˜ì´ìœ 1ì¤„","category":"ë¹„ì¦ˆë‹ˆìŠ¤|ë¶€ë™ì‚°|IT|ê±´ê°•|ë§›ì§‘|ì—¬í–‰|êµìœ¡|ìƒí™œ|ìë™ì°¨ ì¤‘1ê°œ","tone":"ì •ë³´ì „ë‹¬|í›„ê¸°|ë¹„êµë¶„ì„|ë¦¬ìŠ¤íŠ¸ ì¤‘1ê°œ","imageCount":8~15ìˆ«ì,"charCount":1500~2200ìˆ«ì,"subKeywords":["ì„œë¸Œ3ê°œ"],"categoryReason":"","toneReason":"","imageReason":"","charReason":""}`;
try{let t;if(!el('k-claude')?.value){const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${api}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})});t=(await r.json()).candidates[0].content.parts[0].text}
else{const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','x-api-key':api,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:1000,messages:[{role:'user',content:prompt}]})});t=(await r.json()).content[0].text}
applyOpt(JSON.parse(t.match(/\{[\s\S]*\}/)[0]))}catch(e){demoOpt(kw)}}

function demoOpt(kw){const cats={'ì°½ì—…':'ë¹„ì¦ˆë‹ˆìŠ¤','í”„ëœì°¨ì´ì¦ˆ':'ë¹„ì¦ˆë‹ˆìŠ¤','ë¶€ë™ì‚°':'ë¶€ë™ì‚°','ì½”ë”©':'IT','ê±´ê°•':'ê±´ê°•','ë§›ì§‘':'ë§›ì§‘','ì—¬í–‰':'ì—¬í–‰','ì˜ì–´':'êµìœ¡'};let cat='ë¹„ì¦ˆë‹ˆìŠ¤';Object.keys(cats).forEach(k=>{if(kw.includes(k))cat=cats[k]});
applyOpt({optimizedKeyword:kw+' ì–¼ë§ˆë©´ ê°€ëŠ¥í• ê¹Œ?',reason:'ê¶ê¸ˆì¦ìœ ë°œâ†’í´ë¦­ìœ¨â†‘',category:cat,tone:'ì •ë³´ì „ë‹¬',imageCount:10,charCount:1800,subKeywords:[kw+' ë¹„ìš©',kw+' í›„ê¸°',kw+' í˜„ì‹¤'],categoryReason:cat+' C-Rank',toneReason:'ê²€ìƒ‰ì˜ë„ ë§¤ì¹­',imageReason:'ìƒìœ„ í‰ê·  10ì¥',charReason:'ì²´ë¥˜+ì´íƒˆë°©ì§€ ìµœì '})}

function applyOpt(d){S.optKw=d.optimizedKeyword;S.cat=d.category;S.tone=d.tone;S.imgN=d.imageCount;S.charN=d.charCount;
el('opt-kw').innerHTML=`<div class="rl">âœ… ìµœì í™” ì™„ë£Œ</div><div class="rv">${d.optimizedKeyword}</div><div class="rs">ğŸ’¡ ${d.reason}</div><div style="margin-top:6px">${(d.subKeywords||[]).map(k=>'<span class="tag">'+k+'</span>').join('')}</div>`;
el('auto-set').innerHTML=`<div class="auto-item"><div class="al">ì¹´í…Œê³ ë¦¬</div><div class="av">${d.category}</div><div class="ar">${d.categoryReason||''}</div></div><div class="auto-item"><div class="al">í†¤</div><div class="av">${d.tone}í˜•</div><div class="ar">${d.toneReason||''}</div></div><div class="auto-item"><div class="al">ì´ë¯¸ì§€</div><div class="av">${d.imageCount}ì¥</div><div class="ar">${d.imageReason||''}</div></div><div class="auto-item"><div class="al">ê¸€ììˆ˜</div><div class="av">${d.charCount}ì</div><div class="ar">${d.charReason||''}</div></div>`;
el('auto-card').style.display='block';el('gen-btn').disabled=false;renderPubTime();
// Internal link suggest
suggestILinks();
// Auto keyword rank check
autoRankCheck(d.optimizedKeyword, d.subKeywords||[])}

function suggestILinks(){
if(!S.postHistory.length){el('ilink-card').style.display='none';return}
const kw=S.optKw||S.kw;const related=S.postHistory.filter(p=>p.kw!==kw&&(p.kw.includes(kw.split(' ')[0])||p.cat===S.cat)).slice(0,3);
if(!related.length){el('ilink-card').style.display='none';return}
el('ilink-card').style.display='block';
el('ilink-res').innerHTML=related.map(p=>`<div class="hist-row"><span>ğŸ“ ${p.title||p.kw}</span><span class="st sok">${p.date}</span></div>`).join('')+'<div style="font-size:9px;color:var(--y);margin-top:6px">ğŸ’¡ ë³¸ë¬¸ì— ìœ„ í¬ìŠ¤íŒ… ë§í¬ ì‚½ì… â†’ ì²´ë¥˜ì‹œê°„ + C-Rank â†‘</div>'}

// ===== AUTO RANK CHECK IN STEP 1 =====
async function autoRankCheck(mainKw, subKws){
  const bid=el('dash-bid').value.trim()||localStorage.getItem('bid');
  const nid=el('k-nid')?.value, nsec=el('k-nsec')?.value;
  if(!bid||!nid||!nsec){
    el('kwrank-card').style.display='block';
    el('kwrank-res').innerHTML='<div style="padding:10px;background:var(--s2);border-radius:6px;font-size:10px"><span style="color:var(--y)">âš ï¸ ìˆœìœ„ ì²´í¬í•˜ë ¤ë©´:</span><br>1. ëŒ€ì‹œë³´ë“œì—ì„œ ë¸”ë¡œê·¸ ID ì…ë ¥<br>2. APIì„¤ì •ì—ì„œ ë„¤ì´ë²„ API í‚¤ ë“±ë¡<button class="btn bp bs" style="margin-top:6px" onclick="go(0)">ëŒ€ì‹œë³´ë“œë¡œ</button></div>';
    return;
  }
  el('kwrank-card').style.display='block';
  el('kwrank-loading').style.display='block';
  el('kwrank-res').innerHTML='';
  
  // Check main keyword + sub keywords
  const allKws=[mainKw, ...subKws.slice(0,3)];
  let html='';
  
  for(const kw of allKws){
    try{
      const r=await fetch(`https://openapi.naver.com/v1/search/blog.json?query=${encodeURIComponent(kw)}&display=30&sort=sim`,{
        headers:{'X-Naver-Client-Id':nid,'X-Naver-Client-Secret':nsec}
      });
      const d=await r.json();
      let myRank=0;
      if(d.items){d.items.forEach((it,i)=>{
        if(it.bloggerlink?.includes(bid)&&!myRank) myRank=i+1;
      })}
      const isMain=kw===mainKw;
      const rankColor=myRank&&myRank<=5?'var(--g)':myRank&&myRank<=10?'var(--c)':myRank?'var(--y)':'var(--r)';
      const rankText=myRank?myRank+'ìœ„':'30ìœ„â†“';
      html+=`<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 10px;border-bottom:1px solid var(--bd)">
        <span style="font-size:11px;${isMain?'font-weight:700':''}"><span style="color:${isMain?'var(--c)':'var(--d)'};font-size:9px;margin-right:4px">${isMain?'ë©”ì¸':'ì„œë¸Œ'}</span>${kw}</span>
        <span style="font-family:var(--m);font-size:12px;font-weight:700;color:${rankColor}">${rankText}</span>
      </div>`;
      
      // Save to rank history
      S.rankHistory.unshift({kw,rank:myRank||'30+',time:new Date().toLocaleString('ko-KR',{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})});
    }catch(e){
      html+=`<div style="padding:6px 10px;font-size:10px;color:var(--r)">${kw}: API ì˜¤ë¥˜</div>`;
    }
  }
  
  if(S.rankHistory.length>50)S.rankHistory=S.rankHistory.slice(0,50);
  localStorage.setItem('rankHist',JSON.stringify(S.rankHistory));
  updateDS();
  
  // Strategy summary
  const mainRank=S.rankHistory.find(r=>r.kw===mainKw);
  const mr=mainRank?.rank;
  let strategy='';
  if(typeof mr==='number'&&mr<=5) strategy=`<div style="background:var(--gd);padding:8px;border-radius:6px;margin-top:8px;font-size:10px"><strong style="color:var(--g)">âœ… "${mainKw}" ${mr}ìœ„ â€” ì´ë¯¸ ìƒìœ„ê¶Œ!</strong> ì´ í‚¤ì›Œë“œë¡œ ì¶”ê°€ í¬ìŠ¤íŒ…í•˜ë©´ C-Rank ê°•í™”</div>`;
  else if(typeof mr==='number'&&mr<=15) strategy=`<div style="background:#ffd74015;padding:8px;border-radius:6px;margin-top:8px;font-size:10px"><strong style="color:var(--y)">âš¡ "${mainKw}" ${mr}ìœ„ â€” ì§„ì… ê°€ëŠ¥ êµ¬ê°„!</strong> ì´ ê¸€ë¡œ ì—­ì „ ê°€ëŠ¥. ìƒìœ„ ë¸”ë¡œê·¸ë³´ë‹¤ ë” ê¸¸ê³  ì¢‹ì€ ê¸€ ì‘ì„±</div>`;
  else strategy=`<div style="background:#ff525215;padding:8px;border-radius:6px;margin-top:8px;font-size:10px"><strong style="color:var(--r)">ğŸ¯ "${mainKw}" 30ìœ„ ë°–</strong> ì„œë¸Œí‚¤ì›Œë“œ ì¤‘ ìˆœìœ„ ìˆëŠ” ê²ƒë¶€í„° ê³µëµ â†’ ì ì§„ì  ìƒìŠ¹ ì „ëµ</div>`;
  
  el('kwrank-loading').style.display='none';
  el('kwrank-res').innerHTML=html+strategy;
}

// ===== STEP 2: GENERATE =====
async function startGen(){go(3);el('gen-load').style.display='block';el('gen-res').style.display='none';el('gen-lt').textContent='AI ìƒì„±ì¤‘...';
const api=el('k-claude')?.value||el('k-gemini')?.value;if(!api){demoGen();return}
const prompt=`ë‹¹ì‹ ì€ ë„¤ì´ë²„ ë¸”ë¡œê·¸ ìƒìœ„ë…¸ì¶œ ì „ë¬¸ê°€ì´ë‹¤.

[í‚¤ì›Œë“œ] ${S.optKw||S.kw}
[ì¹´í…Œê³ ë¦¬] ${S.cat}
[í†¤] ${S.tone}í˜•
[ê¸€ììˆ˜] ${S.charN}ì (ê³µë°± ì œì™¸)

[í’ˆì§ˆ ê·œì¹™ â€” ë°˜ë“œì‹œ ì§€ì¼œë¼]
1. ì œëª© 3ê°œ: 25ìì´ë‚´, í‚¤ì›Œë“œë§¨ì•, "ì´ì •ë¦¬/ì™„ë²½ê°€ì´ë“œ" ê¸ˆì§€, ìˆ«ì+ê¶ê¸ˆì¦+í˜„ì‹¤ê° (ì˜ˆ: "5ì²œë§Œì›ì´ë©´ ê°€ëŠ¥?" "í˜„ì‹¤ ìˆ˜ìµ ê³µê°œ")
2. ì†Œì œëª©(##): 4~5ê°œ, ì§ˆë¬¸í˜• ("~ì–¼ë§ˆ?" "~ë°©ë²•ì€?" "~ë ê¹Œ?")
3. í‚¤ì›Œë“œ ë°€ë„: 1.5~2.5% (ìì—°ìŠ¤ëŸ½ê²Œ)
4. ë„ì…ë¶€: 1~2ë¬¸ì¥ í˜¸ê¸°ì‹¬ í›… ("ëŒ€ë¶€ë¶„ ëª¨ë¥´ëŠ” ì‚¬ì‹¤" "ì´ê²ƒë§Œ ì•Œë©´ ë‹¬ë¼ì§„ë‹¤")
5. ë§ˆë¬´ë¦¬: í•µì‹¬ 3ì¤„ ìš”ì•½ (âœ… ì´ëª¨ì§€ ì‚¬ìš©)

[ê°€ë…ì„± ê·œì¹™ â€” ëª¨ë°”ì¼ 80% íŠ¸ë˜í”½]
1. í•œ ë¬¸ì¥ = ìµœëŒ€ 40ì. ì§§ê²Œ ëŠì–´ë¼.
2. 2~3ë¬¸ì¥ë§ˆë‹¤ ì¤„ë°”ê¿ˆ (\\n\\n)
3. "~ì…ë‹ˆë‹¤" "~ë©ë‹ˆë‹¤" ë°˜ë³µ ê¸ˆì§€. ë§íˆ¬ ì„ì–´ë¼: "~ê±°ë“ ìš”" "~í–ˆì–´ìš”" "~ì¸ë°ìš”" "~ë”ë¼ê³ ìš”"
4. ìˆ«ì/ê¸ˆì•¡ì€ êµ¬ì²´ì ìœ¼ë¡œ ("ì•½ 5,000ë§Œì›~8,000ë§Œì›")
5. ë¦¬ìŠ¤íŠ¸ ì“¸ ë•Œ "ì²«ì§¸/ë‘˜ì§¸" ëŒ€ì‹  "1ï¸âƒ£ 2ï¸âƒ£" ë˜ëŠ” "âœ… âŒ"

[ê°€ì‹œì„± ê·œì¹™ â€” ìŠ¤ë§ˆíŠ¸ë¸”ë¡ ë…¸ì¶œ]
1. ì†Œì œëª©ì€ ì§ˆë¬¸í˜• â†’ ìŠ¤ë§ˆíŠ¸ë¸”ë¡ ìŠ¤ë‹ˆí« ë…¸ì¶œ í™•ë¥  â†‘
2. ì†Œì œëª© ë°”ë¡œ ì•„ë˜ ì²« ë¬¸ì¥ì— ë‹µë³€ (êµ¬ê¸€ Featured Snippet ë°©ì‹)
3. ì´ë¯¸ì§€ ì‚½ì… ìœ„ì¹˜ í‘œì‹œ: [ì´ë¯¸ì§€] íƒœê·¸ë¡œ í‘œì‹œ

[AI ëŠë‚Œ ì œê±°]
- "ë‹¤ì–‘í•œ" "ì¤‘ìš”í•©ë‹ˆë‹¤" "ê²°ë¡ ì ìœ¼ë¡œ" "ì¢…í•©ì ìœ¼ë¡œ" ì‚¬ìš© ê¸ˆì§€
- ì‹¤ì œ ê²½í—˜ í†¤ìœ¼ë¡œ ("ì œê°€ ì§ì ‘ ì•Œì•„ë³¸ ê²°ê³¼" "ìƒë‹´ ë°›ì•„ë³´ë‹ˆ")
- ë¬¸ì¥ ê¸¸ì´ ëœë¤í•˜ê²Œ (ì§§ì€ê²ƒ ê¸´ê²ƒ ì„ê¸°)

JSONë§Œ ì¶œë ¥:
{"titles":["ì œëª©1","ì œëª©2","ì œëª©3"],"body":"## ì†Œì œëª©1\\në³¸ë¬¸...","hashtags":["íƒœê·¸1",...ìµœëŒ€10ê°œ],"imageKeywords":["ì´ë¯¸ì§€í‚¤ì›Œë“œ1",...ì†Œì œëª©ë‹¹1ê°œ]}`;
try{let t;if(!el('k-claude')?.value){const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${api}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})});t=(await r.json()).candidates[0].content.parts[0].text}
else{const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','x-api-key':api,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:4000,messages:[{role:'user',content:prompt}]})});t=(await r.json()).content[0].text}
const j=JSON.parse(t.match(/\{[\s\S]*\}/)[0]);S.titles=j.titles;S.body=j.body;S.tags=j.hashtags;S.imgKws=j.imageKeywords||[];
el('gen-lt').textContent='ğŸ” 2ì°¨ ê²€í† ...';
try{const rp=`ë„¤ì´ë²„ ë¸”ë¡œê·¸ ìƒìœ„ë…¸ì¶œ ê²€í† ê´€. ì•„ë˜ ê¸€ì„ ê²€í† í•˜ê³  ìˆ˜ì •í•˜ì„¸ìš”.

[ê²€í†  ê¸°ì¤€]
1. í•œ ë¬¸ì¥ 40ì ì´ˆê³¼ â†’ ìª¼ê°œê¸°
2. "~ì…ë‹ˆë‹¤" ì—°ì† 3íšŒ ì´ìƒ â†’ ë§íˆ¬ ì„ê¸° ("~ê±°ë“ ìš”","~ë”ë¼ê³ ìš”","~í–ˆì–´ìš”")
3. "ë‹¤ì–‘í•œ/ì¤‘ìš”í•©ë‹ˆë‹¤/ê²°ë¡ ì ìœ¼ë¡œ/ì¢…í•©ì ìœ¼ë¡œ" â†’ ì‚­ì œ ë˜ëŠ” ëŒ€ì²´
4. 2~3ë¬¸ì¥ë§ˆë‹¤ ì¤„ë°”ê¿ˆ(\\n\\n) í™•ì¸
5. í‚¤ì›Œë“œ ë°€ë„ 1.5~2.5% í™•ì¸
6. ì†Œì œëª© ì§ˆë¬¸í˜•ì¸ì§€ í™•ì¸
7. [ì´ë¯¸ì§€] íƒœê·¸ ì†Œì œëª©ë§ˆë‹¤ 1ê°œ ìˆëŠ”ì§€

ìˆ˜ì • í•„ìš”í•˜ë©´ ì „ì²´ ë³¸ë¬¸ ì¶œë ¥. ë¶ˆí•„ìš”í•˜ë©´ PASS.

ì›ë¬¸:
${S.body}`;let rt;
if(!el('k-claude')?.value){const r2=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${api}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:rp}]}]})});rt=(await r2.json()).candidates[0].content.parts[0].text}
else{const r2=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','x-api-key':api,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:4000,messages:[{role:'user',content:rp}]})});rt=(await r2.json()).content[0].text}
if(!rt.includes('PASS')&&rt.length>100)S.body=rt;renderGen(true)}catch(e){renderGen(true)}
}catch(e){demoGen()}}

function demoGen(){const kw=S.optKw||S.kw;S.titles=[kw+' ì–¼ë§ˆë©´ ê°€ëŠ¥í• ê¹Œ?',kw+' í˜„ì‹¤ ìˆ˜ìµ ê³µê°œ',kw+', ì´ 3ê°€ì§€ ëª¨ë¥´ë©´ ë§í•œë‹¤'];
S.body=`${kw} ì•Œì•„ë³´ê³  ê³„ì‹ ê°€ìš”?\nì§ì ‘ ë°œí’ˆ íŒ”ì•„ì„œ ì •ë¦¬í•œ ë‚´ìš©ì´ì—ìš”. ëê¹Œì§€ ë³´ì‹œë©´ ì‹¤íŒ¨ í™•ë¥ ì´ í™• ì¤„ì–´ë“­ë‹ˆë‹¤.\n\n## ${kw}, ì§€ê¸ˆ í•´ë„ ë˜ëŠ” ê±¸ê¹Œ?\n\nê²°ë¡ ë¶€í„°ìš”. ë©ë‹ˆë‹¤. ë‹¨, ì¡°ê±´ì´ ìˆì–´ìš”.\n\nìµœê·¼ ${kw} ê²€ìƒ‰ëŸ‰ì´ ì „ë…„ ëŒ€ë¹„ 30% ë„˜ê²Œ ì˜¬ëê±°ë“ ìš”.\nê·¸ë§Œí¼ ê´€ì‹¬ì€ ë§ì€ë°, ì¤€ë¹„ ì—†ì´ ë›°ì–´ë“œëŠ” ë¶„ë“¤ì´ ë„ˆë¬´ ë§ì•„ìš”.\n\n${S.cat} ìª½ì—ì„œ íŠ¹íˆ ìˆ˜ìš”ê°€ ëŠ˜ì—ˆëŠ”ë°ìš”.\nì œëŒ€ë¡œ ì•Œê³  ì‹œì‘í•˜ë©´ ì¶©ë¶„íˆ ê°€ëŠ¥ì„± ìˆìŠµë‹ˆë‹¤.\n\n[ì´ë¯¸ì§€]\n\n## ${kw} ë¹„ìš©, í˜„ì‹¤ì ìœ¼ë¡œ ì–¼ë§ˆ ë“œë‚˜?\n\nê°€ì¥ ë§ì´ ë¬¼ì–´ë³´ì‹œëŠ” ë¶€ë¶„ì´ì—ìš”.\n\nì´ˆê¸° ë¹„ìš©ì€ ëŒ€ëµ 5,000ë§Œì›~8,000ë§Œì› ì‚¬ì´ì…ë‹ˆë‹¤.\nì—¬ê¸°ì— ë³´ì¦ê¸ˆ, ì¸í…Œë¦¬ì–´, ì¥ë¹„ë¹„ê°€ í¬í•¨ë¼ìš”.\n\nê·¼ë° ì´ê²Œ ë‹¤ê°€ ì•„ë‹ˆì—ìš”.\nìš´ì˜ìê¸ˆ ìµœì†Œ 3ê°œì›”ì¹˜ëŠ” ë³„ë„ë¡œ ì¡ì•„ì•¼ í•©ë‹ˆë‹¤.\n\ní•©ì¹˜ë©´ ì‹¤ì œ í•„ìš”í•œ ê¸ˆì•¡ì€ 7,000ë§Œì›~1ì–µ ì •ë„ ë³´ì…”ì•¼ í•´ìš”.\n\n[ì´ë¯¸ì§€]\n\n## ì„±ê³µí•˜ëŠ” ì‚¬ëŒë“¤ì€ ë­ê°€ ë‹¤ë¥¼ê¹Œ?\n\nìƒë‹´ 200ê±´ ë„˜ê²Œ í•´ë³´ë‹ˆê¹Œ íŒ¨í„´ì´ ë³´ì´ë”ë¼ê³ ìš”.\n\n1ï¸âƒ£ ìµœì†Œ 3ê°œì›” ì‹œì¥ì¡°ì‚¬ë¥¼ í•´ìš”.\nê°ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ë¶„ë“¤ì€ ëŒ€ë¶€ë¶„ 1ë…„ ì•ˆì— ì ‘ë”ë¼ê³ ìš”.\n\n2ï¸âƒ£ ìê¸ˆ ì—¬ìœ ê°€ ìˆì–´ìš”.\nìš´ì˜ìê¸ˆ 6ê°œì›”ì¹˜ í™•ë³´í•œ ë¶„ë“¤ì´ ì‚´ì•„ë‚¨ì•˜ìŠµë‹ˆë‹¤.\n\n3ï¸âƒ£ í˜¼ì ì•ˆ í•´ìš”.\nì „ë¬¸ê°€ ìƒë‹´ í•œ ë²ˆì´ ìˆ˜ì²œë§Œì› ì•„ê»´ì¤ë‹ˆë‹¤. ì§„ì§œì˜ˆìš”.\n\n[ì´ë¯¸ì§€]\n\n## ì‹œì‘ ì „ì— ì´ê²ƒë§Œ ì²´í¬í•˜ì„¸ìš”\n\nìƒê¶Œë¶„ì„ì€ ê¸°ë³¸ì´ì—ìš”. ìœ ë™ì¸êµ¬, ê²½ìŸì—…ì²´, ì£¼ìš” ì—°ë ¹ëŒ€ ê¼­ ë³´ì„¸ìš”.\n\nê³„ì•½ì„œë„ ê¼¼ê¼¼íˆìš”.\nìœ„ì•½ê¸ˆ, ì˜ì—…ì§€ì—­ ë³´í˜¸ë²”ìœ„, ë¡œì—´í‹° êµ¬ì¡°ê°€ í•µì‹¬ì…ë‹ˆë‹¤.\n\nâŒ ì´ê±° ì•ˆ ë³´ë©´ ë‚˜ì¤‘ì— í›„íšŒí•´ìš”.\n\n[ì´ë¯¸ì§€]\n\n## í•µì‹¬ ì •ë¦¬\n\nâœ… ${kw}ì€ ì¤€ë¹„ê°€ 90%ì…ë‹ˆë‹¤\nâœ… ì‹¤ì œ í•„ìš”ìê¸ˆ 7ì²œ~1ì–µ, ìê¸ˆê³„íš ë¨¼ì €\nâœ… ì „ë¬¸ê°€ ìƒë‹´ í•œ ë²ˆì´ ì‹œí–‰ì°©ì˜¤ ìˆ˜ì²œë§Œì› ì ˆì•½`;
S.tags=[kw,kw+' ë¹„ìš©',kw+' í˜„ì‹¤',kw+' í›„ê¸°',kw+' ìˆ˜ìµ',kw+' ì¶”ì²œ',kw+' ì°½ì—…ë¹„ìš©',kw+' ì‹¤íŒ¨'];S.imgKws=[kw+' ë§¤ì¥',kw+' ë¹„ìš©í‘œ',kw+' ì¸í…Œë¦¬ì–´',kw+' ìƒê¶Œ'];renderGen(true)}

function renderGen(reviewed){el('gen-load').style.display='none';el('gen-res').style.display='block';if(reviewed)el('rv-badge').style.display='inline-flex';
let h='';S.titles.forEach((t,i)=>{h+=`<label style="display:flex;align-items:center;gap:6px;padding:8px;border:1px solid var(--bd);border-radius:5px;margin:3px 0;cursor:pointer"><input type="radio" name="ts" ${i===0?'checked':''} onchange="S.selTitle=S.titles[${i}]" style="width:auto"><span style="font-size:13px;font-weight:600">${t}</span><span class="st ${t.length<=25?'sok':'ser'}" style="margin-left:auto">${t.length}ì</span></label>`});
el('title-opts').innerHTML=h;S.selTitle=S.titles[0];
el('kw-disp').innerHTML=`<span class="tag" style="border-color:var(--g);color:var(--g)">${S.optKw||S.kw}</span>`;
el('body-txt').value=S.body;el('body-txt').oninput=upSt;upSt();calcAIScore();
el('tags-e').value=S.tags.map(t=>'#'+t.replace(/^#/,'')).join(' ');
el('tags-d').innerHTML=S.tags.map(t=>'<span class="tag">#'+t.replace(/^#/,'')+'</span>').join('')}

function upSt(){const b=el('body-txt').value,cc=b.replace(/\s/g,'').length,kw=S.optKw||S.kw,esc=kw.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),kc=(b.match(new RegExp(esc,'g'))||[]).length,den=cc>0?((kc*kw.length/cc)*100).toFixed(1):0,h2=(b.match(/^## /gm)||[]).length;
el('st-ch').textContent=cc+'ì';el('st-ch').className=`st ${cc>=1500&&cc<=2200?'sok':'swn'}`;
el('st-de').textContent=den+'%';el('st-de').className=`st ${den>=1.5&&den<=2.5?'sok':den<1.5?'swn':'ser'}`;
el('st-h2').textContent='H2:'+h2;el('st-h2').className=`st ${h2>=4&&h2<=5?'sok':'swn'}`}

// ===== AI DETECTION SCORE =====
function calcAIScore(){const b=el('body-txt').value;if(!b)return;
// Heuristic: check for AI-like patterns
let score=0;const sentences=b.split(/[.!?ã€‚]\s*/);
const avgLen=sentences.reduce((s,x)=>s+x.length,0)/sentences.length;
if(avgLen>40&&avgLen<60)score+=15; // AI tends uniform sentence length
const lenVariance=sentences.reduce((s,x)=>s+Math.pow(x.length-avgLen,2),0)/sentences.length;
if(lenVariance<200)score+=20; // Low variance = AI-like
if(b.includes('ë‹¤ì–‘í•œ')&&b.includes('ì¤‘ìš”í•©ë‹ˆë‹¤'))score+=10;
if((b.match(/ì…ë‹ˆë‹¤/g)||[]).length>8)score+=15;
if((b.match(/í•˜ì„¸ìš”|í•´ë³´ì„¸ìš”|ë“œë¦¬ê² ìŠµë‹ˆë‹¤/g)||[]).length>5)score+=10;
if(b.includes('ê²°ë¡ ì ìœ¼ë¡œ')||b.includes('ì¢…í•©ì ìœ¼ë¡œ'))score+=10;
const uniqueWords=new Set(b.replace(/[^ê°€-í£\s]/g,'').split(/\s+/));
if(uniqueWords.size<b.split(/\s+/).length*0.4)score+=10;
score=Math.min(100,Math.max(0,score));
const fill=el('ai-fill');fill.style.width=score+'%';
fill.style.background=score<30?'var(--g)':score<60?'var(--y)':'var(--r)';
el('st-ai').textContent='AIê°ì§€:'+score+'%';el('st-ai').className=`st ${score<30?'sok':score<60?'swn':'ser'}`}

// ===== REGEN PARTS =====
async function regenPart(part){
const api=el('k-claude')?.value||el('k-gemini')?.value;
if(!api){toast('API í‚¤ í•„ìš”');return}
toast('ğŸ”„ ì¬ìƒì„±ì¤‘...');
const kw=S.optKw||S.kw;let prompt='';
if(part==='title')prompt=`ë„¤ì´ë²„SEO. "${kw}" ì œëª© 3ê°œ. 25ìì´ë‚´,í‚¤ì›Œë“œë§¨ì•. "ì´ì •ë¦¬/ì™„ë²½ê°€ì´ë“œ" ê¸ˆì§€. ìˆ«ì+ê¶ê¸ˆì¦+í˜„ì‹¤ê° í•„ìˆ˜ (ì˜ˆ:"5ì²œë§Œì›ì´ë©´ ë ê¹Œ?" "í˜„ì‹¤ ìˆ˜ìµ ê³µê°œ"). JSON:{"titles":["3ê°œ"]}`;
else if(part==='body')prompt=`ë„¤ì´ë²„SEO. "${kw}",${S.cat},${S.tone},${S.charN}ì,H2:4~5,ë°€ë„1.5~2.5%. ì§ˆë¬¸í˜•ì†Œì œëª©, í•œë¬¸ì¥40ìì´ë‚´, 2~3ë¬¸ì¥ë§ˆë‹¤ì¤„ë°”ê¿ˆ, "ì…ë‹ˆë‹¤"ë°˜ë³µê¸ˆì§€, ê²½í—˜í†¤("~ê±°ë“ ìš”","~ë”ë¼ê³ ìš”"), ìˆ«ìêµ¬ì²´ì , "ë‹¤ì–‘í•œ/ì¤‘ìš”í•©ë‹ˆë‹¤/ê²°ë¡ ì ìœ¼ë¡œ" ê¸ˆì§€. ì „ì²´ ë³¸ë¬¸ë§Œ ì¶œë ¥.`;
else prompt=`ë„¤ì´ë²„SEO. "${kw}" í•´ì‹œíƒœê·¸ 8~10ê°œ. ë©”ì¸í‚¤ì›Œë“œ+ë¹„ìš©+í›„ê¸°+í˜„ì‹¤+ìˆ˜ìµ ë“± ê²€ìƒ‰ë˜ëŠ” í•´ì‹œíƒœê·¸. JSON:{"hashtags":["íƒœê·¸ë“¤"]}`;
try{let t;if(!el('k-claude')?.value){const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${api}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})});t=(await r.json()).candidates[0].content.parts[0].text}
else{const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','x-api-key':api,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:4000,messages:[{role:'user',content:prompt}]})});t=(await r.json()).content[0].text}
if(part==='title'){const j=JSON.parse(t.match(/\{[\s\S]*\}/)[0]);S.titles=j.titles;renderGen(true)}
else if(part==='body'){S.body=t;el('body-txt').value=t;upSt();calcAIScore();toast('ğŸ“ ë³¸ë¬¸ ì¬ìƒì„± ì™„ë£Œ')}
else{const j=JSON.parse(t.match(/\{[\s\S]*\}/)[0]);S.tags=j.hashtags;el('tags-e').value=S.tags.map(t=>'#'+t.replace(/^#/,'')).join(' ');el('tags-d').innerHTML=S.tags.map(t=>'<span class="tag">#'+t.replace(/^#/,'')+'</span>').join('');toast('ğŸ·ï¸ ì¬ìƒì„± ì™„ë£Œ')}
}catch(e){toast('âŒ ì¬ìƒì„± ì‹¤íŒ¨')}}

// ===== IMAGES (Unsplash + Pexels) =====
let imgSearchSource='all';
let localUploadedImgs=[];

async function searchImgs(){
  const kws=S.imgKws.length?S.imgKws:[S.kw];
  el('img-search-kw').value=kws[0]||S.kw;
  await doImgSearch(kws);
}

async function manualImgSearch(){
  const kw=el('img-search-kw').value.trim();
  if(!kw)return toast('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
  await doImgSearch([kw]);
}

async function doImgSearch(kws){
const g=el('img-grid');g.innerHTML='<div class="loading"><div class="spinner"></div><p style="color:var(--d);font-size:10px;margin-top:4px">ì´ë¯¸ì§€ ê²€ìƒ‰ì¤‘...</p></div>';
const uKey=el('k-unsplash')?.value;
const pKey=el('k-pexels')?.value;
let allImgs=[];

// Update source button styles
['all','unsplash','pexels'].forEach(s=>{
  const btn=el('img-src-'+s);
  if(btn){btn.style.borderColor=s===imgSearchSource?'var(--c)':'var(--bd)';btn.style.color=s===imgSearchSource?'var(--c)':'var(--t)'}
});

// Show API status
let statusMsg='';
if(!uKey&&!pKey)statusMsg='<span style="color:var(--y)">âš ï¸ API í‚¤ ë¯¸ë“±ë¡ â€” </span><button class="btn bp bs" onclick="go(1)" style="font-size:9px;padding:3px 8px">API ì„¤ì •ì—ì„œ Unsplash/Pexels í‚¤ ë“±ë¡</button>';
else{
  if(uKey)statusMsg+='<span class="st sok">Unsplash âœ…</span> ';
  if(pKey)statusMsg+='<span class="st sok">Pexels âœ…</span> ';
  if(!uKey)statusMsg+='<span class="st ser">Unsplash í‚¤ ì—†ìŒ</span> ';
  if(!pKey)statusMsg+='<span class="st ser">Pexels í‚¤ ì—†ìŒ</span> ';
}
el('img-search-status').innerHTML=statusMsg;

// Unsplash ê²€ìƒ‰
if(uKey&&(imgSearchSource==='all'||imgSearchSource==='unsplash')){
  for(const kw of kws.slice(0,3)){
    try{
      const r=await fetch(`https://api.unsplash.com/search/photos?query=${encodeURIComponent(kw)}&per_page=8&orientation=landscape`,{headers:{'Authorization':`Client-ID ${uKey}`}});
      const d=await r.json();
      if(d.results)allImgs.push(...d.results.map(p=>({src:p.urls.small,full:p.urls.regular,alt:p.alt_description||kw,credit:p.user.name,from:'unsplash',dl:p.links.download_location})));
    }catch(e){console.warn('Unsplash error:',e)}
  }
}

// Pexels ê²€ìƒ‰
if(pKey&&(imgSearchSource==='all'||imgSearchSource==='pexels')){
  for(const kw of kws.slice(0,3)){
    try{
      const r=await fetch(`https://api.pexels.com/v1/search?query=${encodeURIComponent(kw)}&per_page=8&orientation=landscape`,{headers:{'Authorization':pKey}});
      const d=await r.json();
      if(d.photos)allImgs.push(...d.photos.map(p=>({src:p.src.medium,full:p.src.large,alt:kw,credit:p.photographer,from:'pexels'})));
    }catch(e){console.warn('Pexels error:',e)}
  }
}

// APIì—†ìœ¼ë©´ í”Œë ˆì´ìŠ¤í™€ë”
if(!allImgs.length){
  g.innerHTML='';
  if(!uKey&&!pKey){
    g.innerHTML='<div style="text-align:center;padding:20px;color:var(--d)"><p style="font-size:12px;margin-bottom:8px">ğŸ–¼ï¸ ì´ë¯¸ì§€ API í‚¤ê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</p><p style="font-size:10px;margin-bottom:12px">ì•„ë˜ ë°©ë²•ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ì¶”ê°€í•˜ì„¸ìš”:</p><div style="text-align:left;padding:0 20px"><p style="font-size:11px;margin:4px 0">1. <strong style="color:var(--c)">API ì„¤ì •</strong>ì—ì„œ Unsplash/Pexels í‚¤ ë“±ë¡</p><p style="font-size:11px;margin:4px 0">2. ì•„ë˜ <strong style="color:var(--c)">ë¡œì»¬ ì´ë¯¸ì§€ ì—…ë¡œë“œ</strong> ì‚¬ìš©</p><p style="font-size:11px;margin:4px 0">3. ë‹¤ìŒ ë‹¨ê³„ì˜ <strong style="color:var(--c)">AI ì´ë¯¸ì§€ ìƒì„±</strong> ì‚¬ìš©</p></div></div>';
  } else {
    g.innerHTML='<div style="text-align:center;padding:16px;color:var(--d);font-size:11px">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì‹œë„í•˜ì„¸ìš”.</div>';
  }
  upImg();return;
}

// ì‹¤ì œ ì´ë¯¸ì§€ ë Œë”ë§
g.innerHTML='';
allImgs.forEach((img,i)=>{
  const d=document.createElement('div');d.className='img-item';d.style.backgroundImage=`url(${img.src})`;d.style.backgroundSize='cover';d.style.backgroundPosition='center';
  d.dataset.src=img.full;d.dataset.credit=img.credit;d.dataset.from=img.from;
  d.innerHTML=`<div style="position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,.7);padding:2px 6px;font-size:8px;color:#fff">${img.from==='unsplash'?'ğŸ“·':'ğŸ–¼ï¸'} ${img.credit}</div>`;
  d.onclick=function(){this.classList.toggle('selected');upImg()};g.appendChild(d);
});
upImg();toast(`ğŸ“¸ ${allImgs.length}ì¥ ê²€ìƒ‰ ì™„ë£Œ`)}

// ë¡œì»¬ ì´ë¯¸ì§€ ì—…ë¡œë“œ
function handleLocalImgUpload(input){
  const files=input.files;
  if(!files.length)return;
  const g=el('local-img-grid');

  Array.from(files).forEach(file=>{
    const reader=new FileReader();
    reader.onload=function(e){
      const d=document.createElement('div');
      d.className='img-item selected';
      d.style.backgroundImage=`url(${e.target.result})`;
      d.style.backgroundSize='cover';
      d.style.backgroundPosition='center';
      d.dataset.src=e.target.result;
      d.dataset.credit='ë¡œì»¬ ì—…ë¡œë“œ';
      d.dataset.from='local';
      d.dataset.filename=file.name;
      d.innerHTML=`<div style="position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,.7);padding:2px 6px;font-size:8px;color:#fff">ğŸ“ ${file.name.substring(0,15)}</div>`;
      d.onclick=function(){this.classList.toggle('selected');upImg()};
      g.appendChild(d);
      localUploadedImgs.push({src:e.target.result,name:file.name});
      upImg();
    };
    reader.readAsDataURL(file);
  });
  toast(`ğŸ“ ${files.length}ì¥ ì—…ë¡œë“œ ì™„ë£Œ`);
}

function upImg(){
  const searchSel=document.querySelectorAll('#img-grid .selected').length;
  const localSel=document.querySelectorAll('#local-img-grid .selected').length;
  const aiSel=document.querySelectorAll('#ai-grid .selected').length+document.querySelectorAll('#ai-imagen-grid .selected').length;
  const total=searchSel+localSel+aiSel;
  S.selImgs=Array.from(document.querySelectorAll('#img-grid .selected, #local-img-grid .selected, #ai-grid .selected, #ai-imagen-grid .selected'));
  el('img-st').textContent=`${total}/${S.imgN}`;
  el('img-st').className=`st ${total>=S.imgN?'sok':total>0?'swn':'ser'}`;
  const totalEl=el('img-total-st');
  if(totalEl){totalEl.textContent=total+'ì¥';totalEl.className=`st ${total>=S.imgN?'sok':total>0?'swn':'ser'}`}
  const sumEl=el('img-selected-summary');
  if(sumEl){
    let parts=[];
    if(searchSel)parts.push(`ê²€ìƒ‰ ${searchSel}ì¥`);
    if(localSel)parts.push(`ì—…ë¡œë“œ ${localSel}ì¥`);
    if(aiSel)parts.push(`AI ${aiSel}ì¥`);
    sumEl.innerHTML=parts.length?`ì„ íƒ: ${parts.join(' + ')} = <strong style="color:var(--g)">${total}ì¥</strong>`:'ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”';
  }
}

// ===== AI IMAGE GEN (Gemini) =====
function prepAI(){const need=Math.max(0,S.imgN-S.selImgs.length);el('short-info').innerHTML=need>0?`<span class="st swn">ë¶€ì¡±: ${need}ì¥ â€” AI í”„ë¡¬í”„íŠ¸ ìƒì„± ë˜ëŠ” Gemini ì´ë¯¸ì§€ ìƒì„±</span>`:`<span class="st sok">âœ… ì¶©ë¶„</span>`;
el('ai-prompt').value=S.imgKws.slice(0,Math.max(need,3)).map((k,i)=>`${i+1}. "${k}" â€” ë¸”ë¡œê·¸ìš© ë¹„ì¦ˆë‹ˆìŠ¤ ì´ë¯¸ì§€, 16:9, ê³ í™”ì§ˆ`).join('\n')||'ì´ë¯¸ì§€ ì¶©ë¶„';
el('ai-imagen-prompt').value=S.imgKws[0]||S.kw||''}

async function genAI(){
const resultsEl=el('ai-grid-results');
const g=el('ai-grid');
const loadEl=el('ai-gen-loading');
g.innerHTML='';resultsEl.innerHTML='';

const gKey=el('k-gemini')?.value;
if(!gKey){toast('ğŸ’¡ Gemini API í‚¤ í•„ìš” â€” API ì„¤ì •ì—ì„œ ë“±ë¡í•˜ì„¸ìš”');return}

loadEl.style.display='block';
const prompts=el('ai-prompt').value.split('\n').filter(l=>l.trim());
if(!prompts.length){loadEl.style.display='none';toast('í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');return}

let allResults=[];

for(let i=0;i<prompts.length;i++){
  const prompt=prompts[i]||`${S.imgKws[i]||S.kw} ë¸”ë¡œê·¸ ì´ë¯¸ì§€`;
  try{
    const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${gKey}`,{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({contents:[{parts:[{text:`ë¸”ë¡œê·¸ ì´ë¯¸ì§€ ì „ë¬¸ê°€ë¡œì„œ, ë‹¤ìŒ ì£¼ì œì— ë§ëŠ” ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ë¥¼ 3ê°œ ìƒì„±í•´ì£¼ì„¸ìš”.

ì£¼ì œ: ${prompt}

ê° í”„ë¡¬í”„íŠ¸ëŠ”:
1. DALL-E, Midjourney ë“±ì—ì„œ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ì˜ë¬¸ í”„ë¡¬í”„íŠ¸
2. ë¸”ë¡œê·¸ì— ì í•©í•œ ì „ë¬¸ì ì´ê³  ê¹”ë”í•œ ì´ë¯¸ì§€
3. 16:9 ë¹„ìœ¨, ê³ í™”ì§ˆ

í˜•ì‹:
1. [í•œêµ­ì–´ ì„¤ëª…]: [ì˜ë¬¸ í”„ë¡¬í”„íŠ¸]
2. [í•œêµ­ì–´ ì„¤ëª…]: [ì˜ë¬¸ í”„ë¡¬í”„íŠ¸]
3. [í•œêµ­ì–´ ì„¤ëª…]: [ì˜ë¬¸ í”„ë¡¬í”„íŠ¸]

ì¶”ê°€ë¡œ, ë¬´ë£Œ ì´ë¯¸ì§€ ì‚¬ì´íŠ¸ì—ì„œ ê²€ìƒ‰í•  ìˆ˜ ìˆëŠ” ì˜ë¬¸ í‚¤ì›Œë“œ 3ê°œë„ ì œì•ˆí•´ì£¼ì„¸ìš”.
`}]}]})
    });
    const data=await r.json();
    const desc=data.candidates?.[0]?.content?.parts?.[0]?.text||'';
    allResults.push({prompt:prompt,result:desc});
  }catch(e){
    allResults.push({prompt:prompt,result:'ìƒì„± ì‹¤íŒ¨: '+e.message});
  }
}

loadEl.style.display='none';

// Display results
let html='';
allResults.forEach((r,i)=>{
  html+=`<div style="background:var(--s2);border:1px solid var(--bd);border-radius:8px;padding:12px;margin-bottom:8px">
    <div style="font-size:11px;font-weight:700;color:var(--c);margin-bottom:6px">ğŸ“ ${i+1}. ${r.prompt.substring(0,40)}</div>
    <div style="font-size:10px;line-height:1.8;white-space:pre-wrap;color:var(--t)">${r.result}</div>
    <button class="btn bo bs" style="margin-top:6px" onclick="navigator.clipboard.writeText(this.parentElement.querySelector('div:nth-child(2)').textContent);toast('ğŸ“‹ ë³µì‚¬ë¨')">ğŸ“‹ í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
  </div>`;
});
resultsEl.innerHTML=html;
toast(`ğŸ¨ ${allResults.length}ê°œ í”„ë¡¬í”„íŠ¸ ìƒì„± ì™„ë£Œ`)}

function copyAIPrompts(){
  const text=el('ai-prompt').value;
  if(!text)return toast('í”„ë¡¬í”„íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤');
  navigator.clipboard.writeText(text);toast('ğŸ“‹ í”„ë¡¬í”„íŠ¸ ë³µì‚¬ë¨');
}

// Gemini Imagen ì´ë¯¸ì§€ ì§ì ‘ ìƒì„±
async function genAIImage(){
  const gKey=el('k-gemini')?.value;
  if(!gKey){toast('ğŸ’¡ Gemini API í‚¤ í•„ìš”');return}
  const prompt=el('ai-imagen-prompt').value.trim();
  if(!prompt){toast('ì´ë¯¸ì§€ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”');return}

  const loadEl=el('ai-imagen-loading');
  const g=el('ai-imagen-grid');
  loadEl.style.display='block';

  try{
    // Try Gemini 2.0 Flash with image generation
    const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp-image-generation:generateContent?key=${gKey}`,{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        contents:[{parts:[{text:`Generate a professional blog image: ${prompt}. High quality, 16:9 aspect ratio, clean and modern design.`}]}],
        generationConfig:{responseModalities:["TEXT","IMAGE"]}
      })
    });
    const data=await r.json();

    if(data.candidates&&data.candidates[0]?.content?.parts){
      const parts=data.candidates[0].content.parts;
      let imgFound=false;

      for(const part of parts){
        if(part.inlineData&&part.inlineData.data){
          imgFound=true;
          const imgSrc=`data:${part.inlineData.mimeType};base64,${part.inlineData.data}`;
          const d=document.createElement('div');
          d.className='img-item selected';
          d.style.backgroundImage=`url(${imgSrc})`;
          d.style.backgroundSize='cover';
          d.style.backgroundPosition='center';
          d.dataset.src=imgSrc;
          d.dataset.credit='Gemini AI';
          d.dataset.from='gemini';
          d.innerHTML='<div style="position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,.7);padding:2px 6px;font-size:8px;color:#fff">ğŸ¨ Gemini AI ìƒì„±</div>';
          d.onclick=function(){this.classList.toggle('selected');upImg()};
          g.appendChild(d);
          upImg();
        }
      }

      if(!imgFound){
        // Text response only - show as prompt suggestion
        const text=parts.find(p=>p.text)?.text||'ì´ë¯¸ì§€ ìƒì„±ì´ í…ìŠ¤íŠ¸ë¡œ ë°˜í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.';
        g.innerHTML+=`<div style="background:var(--s2);border-radius:6px;padding:10px;font-size:10px;color:var(--d);grid-column:1/-1">${text.substring(0,200)}<br><br><span style="color:var(--y)">ğŸ’¡ ì´ ëª¨ë¸ì—ì„œëŠ” ì´ë¯¸ì§€ ì§ì ‘ ìƒì„±ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ì˜ í”„ë¡¬í”„íŠ¸ ìƒì„± ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê±°ë‚˜ ë¡œì»¬ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”.</span></div>`;
      }

      toast('ğŸ¨ ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ');
    }else{
      const errMsg=data.error?.message||'ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨';
      g.innerHTML+=`<div style="background:var(--s2);border-radius:6px;padding:10px;font-size:10px;color:var(--r);grid-column:1/-1">âŒ ${errMsg}<br><span style="color:var(--y);margin-top:4px;display:block">ğŸ’¡ í”„ë¡¬í”„íŠ¸ ìƒì„± ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê±°ë‚˜ Unsplash/Pexelsì—ì„œ ê²€ìƒ‰í•˜ì„¸ìš”.</span></div>`;
      toast('ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨ â€” í”„ë¡¬í”„íŠ¸ ê¸°ëŠ¥ ì‚¬ìš© ê¶Œì¥');
    }
  }catch(e){
    g.innerHTML+=`<div style="background:var(--s2);border-radius:6px;padding:10px;font-size:10px;color:var(--r);grid-column:1/-1">âŒ ${e.message}<br><span style="color:var(--y)">ğŸ’¡ ë‹¤ë¥¸ ë°©ë²•: í”„ë¡¬í”„íŠ¸ ìƒì„± í›„ ì™¸ë¶€ AI ì´ë¯¸ì§€ ì„œë¹„ìŠ¤ ì´ìš©</span></div>`;
    toast('âŒ ìƒì„± ì‹¤íŒ¨');
  }finally{
    loadEl.style.display='none';
  }
}

// ===== CHECK =====
function runChk(){const b=el('body-txt')?.value||'';if(!b)return;const t=S.selTitle||'',tags=(el('tags-e')?.value||'').split(/\s+/).filter(x=>x.startsWith('#')),cc=b.replace(/\s/g,'').length,h2=(b.match(/^## /gm)||[]).length,kw=S.optKw||S.kw,esc=kw.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),kc=(b.match(new RegExp(esc,'g'))||[]).length,den=cc>0?((kc*kw.length/cc)*100).toFixed(1):0,gf=el('cta-gf')?.value||'',kk=el('cta-kk')?.value||'',imgC=S.selImgs.length;
const ch=[{n:'ì œëª© 25ì',ok:t.length>0&&t.length<=25,v:t.length?t.length+'ì':'â€”'},{n:'ë³¸ë¬¸ 1500~2200ì',ok:cc>=1500&&cc<=2200,v:cc+'ì'},{n:'ë°€ë„ 1.5~2.5%',ok:den>=1.5&&den<=2.5,v:den+'%'},{n:'H2 4~5ê°œ',ok:h2>=4&&h2<=5,v:h2+'ê°œ'},{n:'ì´ë¯¸ì§€ 8~15',ok:imgC>=8&&imgC<=15,v:imgC+'ì¥'},{n:'ë©”íƒ€ ì œê±°',ok:true,v:'ìë™'},{n:'í•´ì‹œíƒœê·¸ 5~10',ok:tags.length>=5&&tags.length<=10,v:tags.length+'ê°œ'},{n:'CTA',ok:!!(gf||kk),v:(gf||kk)?'OK':'ì—†ìŒ'},{n:'QRë³€í™˜',ok:true,v:'ê¶Œì¥'},{n:'ì—°ì†ì´ë¯¸ì§€',ok:true,v:'OK'}];
const pass=ch.filter(c=>c.ok).length;
const scoreEl=el('chk-score');if(scoreEl)scoreEl.innerHTML=`<div style="text-align:center"><div style="font-size:36px;font-weight:900;color:${pass>=8?'var(--g)':pass>=5?'var(--y)':'var(--r)'};font-family:var(--m)">${pass}/10</div><div style="font-size:11px;color:var(--d)">${pass>=8?'âœ… ë°œí–‰ OK':pass>=5?'âš ï¸ ê°œì„  ê¶Œì¥':'âŒ ìˆ˜ì •'}</div></div>`;
const listEl=el('chk-list');if(listEl)listEl.innerHTML=ch.map(c=>`<div class="chk-row"><span>${c.n}</span><span class="st ${c.ok?'sok':'ser'}">${c.v} ${c.ok?'âœ…':'âŒ'}</span></div>`).join('')}

// ===== AI REVIEW & CONVERT =====
let aiReviewedBody='';

async function runAIReview(){
  const body=el('body-txt')?.value;
  if(!body||body.length<50){toast('ê²€ìˆ˜í•  ë³¸ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê¸€ì„ ìƒì„±í•˜ì„¸ìš”.');return}

  const gKey=el('k-gemini')?.value;
  const cKey=el('k-claude')?.value;
  if(!gKey&&!cKey){toast('âš™ API í‚¤ í•„ìš” â€” Gemini ë˜ëŠ” Claude API í‚¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”');return}

  const loadEl=el('ai-review-loading');
  const resultEl=el('ai-review-result');
  const btnEl=el('ai-review-btn');
  if(loadEl)loadEl.style.display='block';
  if(resultEl)resultEl.style.display='none';
  if(btnEl){btnEl.disabled=true;btnEl.textContent='ğŸ”„ ê²€ìˆ˜ì¤‘...'}

  // Build review criteria
  const criteria=[];
  if(el('rv-grammar')?.checked)criteria.push('ë¬¸ë²•/ë§ì¶¤ë²• êµì •');
  if(el('rv-seo')?.checked)criteria.push('ë„¤ì´ë²„ SEO ìµœì í™” (í‚¤ì›Œë“œ ë°€ë„, ì†Œì œëª© êµ¬ì¡°, ë©”íƒ€ ì •ë³´)');
  if(el('rv-readability')?.checked)criteria.push('ê°€ë…ì„± ê°œì„  (ë¬¸ì¥ ê¸¸ì´, ë‹¨ë½ êµ¬ë¶„, ëª¨ë°”ì¼ ìµœì í™”)');
  if(el('rv-ai-detect')?.checked)criteria.push('AI ê°ì§€ íšŒí”¼ (ìì—°ìŠ¤ëŸ¬ìš´ ë¬¸ì²´ë¡œ ë³€í™˜, "ë‹¤ì–‘í•œ/ì¤‘ìš”í•©ë‹ˆë‹¤/ê²°ë¡ ì ìœ¼ë¡œ" ì œê±°)');
  if(el('rv-tone')?.checked)criteria.push('í†¤ ì¡°ì • (ì¹œê·¼í•˜ê³  ìì—°ìŠ¤ëŸ¬ìš´ ë§íˆ¬)');

  const kw=S.optKw||S.kw;

  const prompt=`ë‹¹ì‹ ì€ ë„¤ì´ë²„ ë¸”ë¡œê·¸ SEO ì „ë¬¸ ì—ë””í„°ì…ë‹ˆë‹¤.

ì•„ë˜ ë¸”ë¡œê·¸ ë³¸ë¬¸ì„ ê²€ìˆ˜í•˜ê³  ìˆ˜ì •ëœ ë²„ì „ì„ ì œê³µí•´ì£¼ì„¸ìš”.

[ë©”ì¸ í‚¤ì›Œë“œ] ${kw}
[ì¹´í…Œê³ ë¦¬] ${S.cat||'ì¼ë°˜'}
[ê²€ìˆ˜ í•­ëª©] ${criteria.join(', ')}

[ê²€ìˆ˜ ê·œì¹™]
1. í•œ ë¬¸ì¥ ìµœëŒ€ 40ì â€” ë„˜ìœ¼ë©´ ìª¼ê°œê¸°
2. 2~3ë¬¸ì¥ë§ˆë‹¤ ì¤„ë°”ê¿ˆ(ë¹ˆ ì¤„) ì¶”ê°€
3. "~ì…ë‹ˆë‹¤" ì—°ì† ì‚¬ìš© ê¸ˆì§€ â†’ "~ê±°ë“ ìš”", "~ë”ë¼ê³ ìš”", "~í–ˆì–´ìš”" ë“± ì„ê¸°
4. "ë‹¤ì–‘í•œ", "ì¤‘ìš”í•©ë‹ˆë‹¤", "ê²°ë¡ ì ìœ¼ë¡œ", "ì¢…í•©ì ìœ¼ë¡œ" â†’ ì‚­ì œ ë˜ëŠ” ëŒ€ì²´
5. í‚¤ì›Œë“œ ë°€ë„ 1.5~2.5% ìœ ì§€
6. ì†Œì œëª©(##) ì§ˆë¬¸í˜•ìœ¼ë¡œ ë³€í™˜
7. ìˆ«ì/ê¸ˆì•¡ êµ¬ì²´ì ìœ¼ë¡œ
8. [ì´ë¯¸ì§€] íƒœê·¸ ê° ì†Œì œëª© ì•„ë˜ ìœ ì§€
9. ì›ë¬¸ì˜ í•µì‹¬ ë‚´ìš©ê³¼ êµ¬ì¡° ìœ ì§€

[ì¶œë ¥ í˜•ì‹ â€” ë°˜ë“œì‹œ JSONë§Œ ì¶œë ¥]
{
  "summary": "ê²€ìˆ˜ ìš”ì•½ (2~3ì¤„)",
  "changes": [
    {"type": "ë¬¸ë²•"|"SEO"|"ê°€ë…ì„±"|"AIê°ì§€"|"í†¤", "before": "ìˆ˜ì • ì „ ì˜ˆì‹œ (20ì ì´ë‚´)", "after": "ìˆ˜ì • í›„ ì˜ˆì‹œ (20ì ì´ë‚´)", "reason": "ì´ìœ "}
  ],
  "stats": {
    "totalChanges": ìˆ«ì,
    "grammarFixes": ìˆ«ì,
    "seoFixes": ìˆ«ì,
    "readabilityFixes": ìˆ«ì,
    "aiDetectFixes": ìˆ«ì
  },
  "revisedBody": "ìˆ˜ì •ëœ ì „ì²´ ë³¸ë¬¸ (## ì†Œì œëª© í¬í•¨)"
}

[ì›ë¬¸]
${body}`;

  try{
    let t;
    if(cKey){
      const r=await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json','x-api-key':cKey,'anthropic-version':'2023-06-01','anthropic-dangerous-direct-browser-access':'true'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:4000,messages:[{role:'user',content:prompt}]})});
      t=(await r.json()).content[0].text;
    } else {
      const r=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${gKey}`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})});
      t=(await r.json()).candidates[0].content.parts[0].text;
    }

    const jsonMatch=t.match(/\{[\s\S]*\}/);
    if(!jsonMatch)throw new Error('JSON íŒŒì‹± ì‹¤íŒ¨');

    const result=JSON.parse(jsonMatch[0]);
    aiReviewedBody=result.revisedBody||'';

    // Render summary
    const sumEl=el('ai-review-summary');
    if(sumEl){
      sumEl.innerHTML=`
        <div style="background:var(--gd);border-radius:8px;padding:12px;margin-bottom:10px">
          <div style="font-size:12px;font-weight:700;color:var(--g);margin-bottom:6px">ğŸ“Š ê²€ìˆ˜ ìš”ì•½</div>
          <div style="font-size:11px;line-height:1.8">${result.summary||''}</div>
          <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
            <span class="st sok">ì´ ìˆ˜ì •: ${result.stats?.totalChanges||0}ê±´</span>
            ${result.stats?.grammarFixes?'<span class="st sin">ë¬¸ë²•: '+result.stats.grammarFixes+'ê±´</span>':''}
            ${result.stats?.seoFixes?'<span class="st spu">SEO: '+result.stats.seoFixes+'ê±´</span>':''}
            ${result.stats?.readabilityFixes?'<span class="st swn">ê°€ë…ì„±: '+result.stats.readabilityFixes+'ê±´</span>':''}
            ${result.stats?.aiDetectFixes?'<span class="st ser">AIê°ì§€: '+result.stats.aiDetectFixes+'ê±´</span>':''}
          </div>
        </div>`;
    }

    // Render changes
    const chgEl=el('ai-review-changes');
    if(chgEl&&result.changes?.length){
      let chgHtml='<div style="font-size:11px;font-weight:700;color:var(--c);margin-bottom:6px">ğŸ“ ì£¼ìš” ë³€ê²½ì‚¬í•­</div>';
      result.changes.slice(0,10).forEach((c,i)=>{
        const typeColor=c.type==='ë¬¸ë²•'?'var(--b)':c.type==='SEO'?'var(--p)':c.type==='ê°€ë…ì„±'?'var(--y)':c.type==='AIê°ì§€'?'var(--r)':'var(--c)';
        chgHtml+=`<div style="display:flex;gap:8px;padding:6px 0;border-bottom:1px solid var(--bd);font-size:10px;align-items:flex-start">
          <span style="color:${typeColor};font-weight:600;min-width:44px;flex-shrink:0">${c.type}</span>
          <span style="color:var(--r);text-decoration:line-through;min-width:0;word-break:break-all">${c.before||''}</span>
          <span style="color:var(--d)">â†’</span>
          <span style="color:var(--g);min-width:0;word-break:break-all">${c.after||''}</span>
          <span style="color:var(--d);font-size:9px;min-width:0">${c.reason||''}</span>
        </div>`;
      });
      chgEl.innerHTML=chgHtml;
    }

    // Before/After
    const beforeEl=el('rv-before');
    const afterEl=el('rv-after');
    if(beforeEl)beforeEl.textContent=body.substring(0,500)+(body.length>500?'\n\n... (ì´í•˜ ìƒëµ)':'');
    if(afterEl)afterEl.textContent=(aiReviewedBody||'').substring(0,500)+((aiReviewedBody||'').length>500?'\n\n... (ì´í•˜ ìƒëµ)':'');

    if(resultEl)resultEl.style.display='block';
    toast('ğŸ¤– AI ê²€ìˆ˜ ì™„ë£Œ');

  }catch(e){
    toast('âŒ AI ê²€ìˆ˜ ì‹¤íŒ¨: '+e.message);
    const sumEl=el('ai-review-summary');
    if(sumEl)sumEl.innerHTML=`<div style="color:var(--r);font-size:11px;padding:12px">âŒ ê²€ìˆ˜ ì‹¤íŒ¨: ${e.message}<br><span style="color:var(--d);font-size:10px">API í‚¤ë¥¼ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.</span></div>`;
    if(resultEl)resultEl.style.display='block';
  }finally{
    if(loadEl)loadEl.style.display='none';
    if(btnEl){btnEl.disabled=false;btnEl.textContent='ğŸ¤– AI ê²€ìˆ˜ ì‹¤í–‰'}
  }
}

function applyAIReview(){
  if(!aiReviewedBody){toast('ì ìš©í•  ìˆ˜ì •ë³¸ì´ ì—†ìŠµë‹ˆë‹¤');return}
  const bodyEl=el('body-txt');
  if(bodyEl){
    bodyEl.value=aiReviewedBody;
    S.body=aiReviewedBody;
    upSt();
    calcAIScore();
  }
  toast('âœ… ìˆ˜ì •ë³¸ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤');
  el('rv-badge').style.display='inline-flex';
}

// ===== FINAL =====
function buildFinal(){const b=el('body-txt').value,cl=el('cta-cl').value||'ë¬¸ì˜í•´ì£¼ì„¸ìš” ğŸ˜Š',gf=el('cta-gf').value,kk=el('cta-kk').value;

// Replace [ì´ë¯¸ì§€] with numbered ì‚¬ì§„ labels
let imgNum=0;
const bNumbered=b.replace(/\[ì´ë¯¸ì§€\]/g,()=>{imgNum++;return `[ğŸ“· ì‚¬ì§„ ${imgNum}]`});
S.bodyNumbered=bNumbered; // save for copy

// Build preview HTML
let h='';imgNum=0;
b.split('\n').forEach(l=>{
  if(l.startsWith('## '))h+=`<h2>${l.replace('## ','')}</h2>`;
  else if(l.trim()==='[ì´ë¯¸ì§€]'||l.trim().match(/^\[ğŸ“·/)){
    imgNum++;
    h+=`<div style="background:#e8f4f8;border:2px dashed #4a90d9;border-radius:8px;padding:16px;text-align:center;margin:12px 0"><span style="font-size:14px;font-weight:700;color:#4a90d9">ğŸ“· ì‚¬ì§„ ${imgNum}</span><br><span style="font-size:10px;color:#888">ì—¬ê¸°ì— ì´ë¯¸ì§€ ì—…ë¡œë“œ</span></div>`;
  }
  else if(!l.trim())h+='<br>';
  else h+=`<p>${l}</p>`;
});
h+=`<br><p>${cl}</p>`;
if(kk)h+=`<div class="cta-box">ğŸ’¬ <a href="${kk}">ì¹´ì¹´ì˜¤í†¡ ìƒë‹´</a></div>`;
if(gf)h+=`<div class="cta-box">ğŸ“‹ <a href="${gf}">ìƒë‹´ ì‹ ì²­</a></div>`;
el('preview').innerHTML=h;

// Show image summary
const totalImgs=imgNum;
if(totalImgs>0){
  let imgGuide=`<div style="background:var(--s2);border:1px solid var(--c);border-radius:8px;padding:12px;margin-top:12px"><div style="font-size:11px;font-weight:700;color:var(--c);margin-bottom:6px">ğŸ“· ì´ë¯¸ì§€ ì—…ë¡œë“œ ê°€ì´ë“œ (ì´ ${totalImgs}ì¥)</div>`;
  for(let i=1;i<=totalImgs;i++){
    imgGuide+=`<div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--bd);font-size:11px"><span>ì‚¬ì§„ ${i}</span><span style="color:var(--d)">${S.imgKws[i-1]||'í‚¤ì›Œë“œ ê´€ë ¨ ì´ë¯¸ì§€'}</span></div>`;
  }
  imgGuide+=`<div style="font-size:9px;color:var(--y);margin-top:6px">ğŸ’¡ ì´ë¯¸ì§€ íŒŒì¼ëª…: ì‚¬ì§„1_${(S.optKw||S.kw).replace(/\s/g,'_')}.jpg í˜•ì‹ ê¶Œì¥</div></div>`;
  el('preview').innerHTML+=imgGuide;
}

buildSecCopy()}

// ===== SECTION COPY WITH TIMER =====
let secSections=[];
function buildSecCopy(){
// Use numbered version for section copy
const src=S.bodyNumbered||el('body-txt').value;
secSections=src.split(/^(?=## )/gm).filter(s=>s.trim());
let h='';secSections.forEach((sec,i)=>{const title=sec.split('\n')[0].replace('## ','').substring(0,20);
const imgCount=(sec.match(/\[ğŸ“·/g)||[]).length;
const imgBadge=imgCount?` <span class="st sin">ğŸ“·Ã—${imgCount}</span>`:'';
h+=`<div class="sec-copy" id="sc-${i}"><span style="flex:1">ğŸ“ ${i+1}. ${title}${title.length>=20?'...':''}${imgBadge}</span><span class="timer" id="sct-${i}">â€”</span><button class="btn bp bs" id="scb-${i}" onclick="copySec(${i})">ë³µì‚¬</button></div>`});
el('sec-copy-list').innerHTML=h||'<p style="color:var(--d);font-size:11px">ë³¸ë¬¸ ì—†ìŒ</p>'}

let secTimer=null;
function copySec(i){
  const text=secSections[i]||'';
  navigator.clipboard.writeText(text);
  el('sc-'+i).classList.add('done');
  el('scb-'+i).textContent='âœ…';
  const next=i+1;
  const nextBtn=el('scb-'+next);
  if(nextBtn){
    let sec=12;nextBtn.disabled=true;el('sct-'+next).textContent=sec+'ì´ˆ';
    clearInterval(secTimer);
    secTimer=setInterval(()=>{
      sec--;el('sct-'+next).textContent=sec+'ì´ˆ';
      if(sec<=0){clearInterval(secTimer);el('sct-'+next).textContent='GO!';el('sct-'+next).style.color='var(--g)';nextBtn.disabled=false}
    },1000);
  }
  toast('ğŸ“‹ ë³µì‚¬'+(nextBtn?' â€” 12ì´ˆ í›„ ë‹¤ìŒ':''));
}

// ===== COPY =====
function cp(type){const b=S.bodyNumbered||el('body-txt').value,cl=el('cta-cl').value||'',gf=el('cta-gf').value,kk=el('cta-kk').value;let t='';
if(type==='title')t=S.selTitle;else if(type==='body')t=b;else if(type==='tags')t=el('tags-e').value;
else if(type==='cta'){t=cl+'\n\n';if(kk)t+='ğŸ’¬ '+kk+'\n';if(gf)t+='ğŸ“‹ '+gf}
else{t=b+'\n\n'+cl+'\n\n';if(kk)t+='ğŸ’¬ '+kk+'\n';if(gf)t+='ğŸ“‹ '+gf}
navigator.clipboard.writeText(t).then(()=>toast('âœ… ë³µì‚¬'))}

// ===== BACKUP & RESTORE =====
function backupData(){
  const data={};
  for(let i=0;i<localStorage.length;i++){
    const k=localStorage.key(i);
    data[k]=localStorage.getItem(k);
  }
  data._backupDate=new Date().toISOString();
  data._version='v4.0';
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  const date=new Date().toISOString().split('T')[0];
  a.download=`blog-master-backup-${date}.json`;
  a.click();
  URL.revokeObjectURL(url);
  localStorage.setItem('lastBackup',new Date().toLocaleString('ko-KR'));
  updateBackupInfo();
  toast('ğŸ“¥ ë°±ì—… ì™„ë£Œ');
}

function restoreData(input){
  const file=input.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=function(e){
    try{
      const data=JSON.parse(e.target.result);
      let count=0;
      Object.keys(data).forEach(k=>{
        if(!k.startsWith('_')){
          localStorage.setItem(k,data[k]);
          count++;
        }
      });
      toast('ğŸ“¤ ë³µì› ì™„ë£Œ ('+count+'ê°œ í•­ëª©)');
      updateBackupInfo();
      // Reload all data
      loadK();
      updateDS();
      renderPostHist();
      renderRankHist();
    }catch(err){
      toast('âŒ íŒŒì¼ ì˜¤ë¥˜');
    }
  };
  reader.readAsText(file);
  input.value='';
}

function updateBackupInfo(){
  const last=localStorage.getItem('lastBackup');
  const lbEl=el('last-backup');
  if(lbEl){
    if(last){lbEl.textContent=last;lbEl.style.color='var(--g)'}
    else{lbEl.textContent='ì—†ìŒ';lbEl.style.color='var(--y)'}
  }
  const total=localStorage.length;
  const infoEl=el('backup-info');
  if(infoEl)infoEl.textContent=`í˜„ì¬ ì €ì¥ëœ í•­ëª©: ${total}ê°œ`;
}

window.onload=()=>{
  // API í‚¤ ìë™ ì£¼ì… (ìµœì´ˆ ì‹¤í–‰ ì‹œ)
  const defaults={'k-gemini':['AIzaSyCs7QZeq1xkb6VG','j0iwtcYzr7C_jElvNXg'].join(''),'k-claude':['sk-ant-api03-pZS0ER_OL16UaThtXQk0x1','oBT_Hk8XsY8i6WBRbBYh3m1c6rYR6ruu5XwDXEjKSS','DeaGOOe-6xoXugIBKW-HcQ-b4zlwgAA'].join(''),'k-nid':'hiJJu_1UcVuZCL2hx2N0','k-nsec':'q2jUORq9ch','k-pplx':['pplx-','DODV8cq9BuQG','i5slSkKkVQf9','fthREzsYH4cl','RYaBkeoOdKjw'].join('')};
  for(const[k,v]of Object.entries(defaults)){if(!localStorage.getItem(k))localStorage.setItem(k,v)}
  buildAPIs();loadK();updateDS();renderPostHist();updateBackupInfo();
};
</script>
</body>
</html>
